<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Vann Track Duration ‚Äî v7</title>
  <meta name="description" content="Track work time with custom rounding, month view, multi-language, dark/light theme, CSV, print-ready and AdSense ready." />

  <!-- Google AdSense (paste exactly as requested) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3313525409837398"
     crossorigin="anonymous"></script>

  <style>
    :root{--bg:#0f1720;--card:#0b1220;--text:#ecf0f1;--muted:#9aa6b2;--accent:#06b6d4;--accent-2:#7dd3fc;--success:#16a34a;--danger:#ef4444;--glass:rgba(255,255,255,0.03);--radius:12px;--shadow:0 10px 30px rgba(2,6,23,0.6);--table-border:rgba(255,255,255,0.04)}
    body.light-mode{--bg:#f8fafc;--card:#ffffff;--text:#0b1220;--muted:#4b5563;--accent:#0ea5a3;--accent-2:#bae6fd;--glass:rgba(2,6,23,0.03);--shadow:0 8px 20px rgba(2,6,23,0.08);--table-border:rgba(2,6,23,0.06)}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;padding:28px}
    .wrap{max-width:1100px;margin:0 auto}
    .card{background:linear-gradient(180deg,var(--card),rgba(255,255,255,0.01));padding:22px;border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid var(--glass)}

    header.app-head{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title-wrap{display:flex;flex-direction:column}
    h1.title{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px;margin-top:6px}
    .controls-top{display:flex;gap:10px;align-items:center;margin-top:14px}

    .lang-select{display:flex;gap:6px}
    .lang-select button{background:transparent;border:1px solid var(--table-border);padding:6px 10px;border-radius:8px;color:var(--text);cursor:pointer}

    .inputs{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input[type=date],input[type=time],input[type=text]{background:transparent;border:1px solid var(--table-border);padding:10px;border-radius:8px;color:var(--text)}
    input::placeholder{color:var(--muted)}
    button.btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    button.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#022}
    button.ghost{background:transparent;border:1px solid var(--table-border);color:var(--text)}
    .small{font-size:13px;color:var(--muted)}

    .table-wrap{overflow:auto;margin-top:18px;border-radius:10px}
    table{width:100%;border-collapse:collapse;min-width:720px}
    thead th{padding:10px 12px;text-align:left;color:var(--muted);font-size:12px;text-transform:uppercase;border-bottom:1px solid var(--table-border)}
    tbody td{padding:12px 12px;border-bottom:1px solid var(--table-border)}
    tbody tr:nth-child(odd){background:rgba(255,255,255,0.01)}
    tbody tr.day-off td{font-style:italic;color:var(--muted)}
    .actions{display:flex;gap:8px}
    .chip{padding:6px 10px;border-radius:8px;font-weight:600;cursor:pointer}
    .chip.edit{background:var(--success);color:#fff;border:none}
    .chip.del{background:var(--danger);color:#fff;border:none}

    .footer{display:flex;justify-content:flex-end;margin-top:14px}
    .total-card{background:var(--glass);padding:12px 16px;border-radius:10px;color:var(--text);font-weight:700}

    .month-nav{display:flex;gap:8px;align-items:center}
    .month-label{font-weight:700}

    /* print styles */
    @media print{
      @page{size:A4 landscape;margin:12mm}
      body,html{background:#fff;color:#000}
      .card{background:#fff;box-shadow:none;border:none}
      .controls-top, .lang-select, .chip, button{display:none!important}
      table{width:100%;border-collapse:collapse}
      thead th, tbody td{border:1px solid #ccc;padding:8px;color:#000;background:#fff}
      thead th{background:#f2f2f2}
      td.actions{display:none}
      .total-card{background:transparent;color:#000}
    }

    @media(max-width:820px){.inputs{flex-direction:column;align-items:flex-start}table{min-width:600px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header class="app-head">
        <div class="title-wrap">
          <h1 class="title" id="app-title">TheVann Track Duration</h1>
          <div class="subtitle" id="app-sub">Auto rounding, monthly view, multi-language</div>
        </div>
        <div style="display:flex;align-items:center;gap:12px">
          <div class="lang-select" id="lang-buttons">
            <button data-lang="en">English</button>
            <button data-lang="my">·Äô·Äº·Äî·Ä∫·Äô·Ä¨</button>
            <button data-lang="th">‡πÑ‡∏ó‡∏¢</button>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <div class="small" id="theme-label">Dark</div>
            <div class="toggle btn ghost" id="theme-toggle">üåô</div>
          </div>
        </div>
      </header>

      <div class="controls-top">
        <div class="month-nav">
          <button class="btn ghost" id="prev-month">‚óÄ</button>
          <div class="month-label" id="month-label">Month</div>
          <button class="btn ghost" id="next-month">‚ñ∂</button>
          <button class="btn ghost" id="today-month">Today</button>
        </div>

        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
          <button class="btn ghost" id="export-csv">Export CSV</button>
          <button class="btn ghost" id="print-btn">Print</button>
        </div>
      </div>

      <form id="entry-form" class="controls-top" onsubmit="return false;" style="margin-top:12px">
        <div class="inputs">
          <input id="date-input" type="date" required />
          <input id="start-input" type="time" required />
          <input id="end-input" type="time" required />
          <input id="task-input" type="text" placeholder="Task / notes (optional)" />
          <div id="preview" class="small">Duration: 00:00 (0.00h)</div>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn primary" id="add-btn">Add Entry</button>
          <button class="btn ghost" id="dayoff-btn" type="button">Add Day Off</button>
        </div>
      </form>

      <div class="table-wrap">
        <table id="entries-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Start</th>
              <th>End</th>
              <th>Duration (H:M)</th>
              <th>Rounded (hrs)</th>
              <th>Task</th>
              <th class="actions">Actions</th>
            </tr>
          </thead>
          <tbody id="entries-body"></tbody>
        </table>
      </div>

      <div class="footer"><div class="total-card" id="total-card">Total Rounded Hours: <span id="total">0.00</span></div></div>
    </div>
  </div>

  <script>
    (function(){
      // storage keys
      const STORAGE = 'vann_v7_entries';
      const THEME = 'vann_v7_theme';
      const LANG = 'vann_v7_lang';
      const MONTH = 'vann_v7_month';

      // DOM
      const dateEl = document.getElementById('date-input');
      const startEl = document.getElementById('start-input');
      const endEl = document.getElementById('end-input');
      const taskEl = document.getElementById('task-input');
      const previewEl = document.getElementById('preview');
      const addBtn = document.getElementById('add-btn');
      const dayOffBtn = document.getElementById('dayoff-btn');
      const entriesBody = document.getElementById('entries-body');
      const totalEl = document.getElementById('total');
      const exportBtn = document.getElementById('export-csv');
      const printBtn = document.getElementById('print-btn');
      const prevMonthBtn = document.getElementById('prev-month');
      const nextMonthBtn = document.getElementById('next-month');
      const todayMonthBtn = document.getElementById('today-month');
      const monthLabel = document.getElementById('month-label');
      const langButtons = document.getElementById('lang-buttons');
      const themeToggle = document.getElementById('theme-toggle');
      const themeLabel = document.getElementById('theme-label');

      // translations
      const translations = {
        en: {
          app_title: 'TheVann Track Duration', subtitle: 'Auto rounding, monthly view, multi-language',
          add_entry: 'Add Entry', add_dayoff: 'Add Day Off', export_csv: 'Export CSV', print: 'Print',
          duration_default: 'Duration: 00:00 (0.00h)', total_label: 'Total Rounded Hours:', prev: 'Prev', next: 'Next', today: 'Today',
          alert_fill: 'Please fill Date, Start and End.'
        },
        my: {
          app_title: 'Thevann ·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏', subtitle: '·Ä°·Äú·Ä≠·ÄØ·Ä°·Äú·Äª·Ä±·Ä¨·ÄÄ·Ä∫ ·Äï·Äê·Ä∫·Äú·Ää·Ä∫·ÄÖ·ÄÆ·ÄÖ·ÄÖ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Åä ·Äú·ÄÖ·Äâ·Ä∫ ·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äõ·Äæ·ÄØ·Äô·Äæ·ÄØ·Åä ·Äò·Ä¨·Äû·Ä¨·ÄÖ·ÄÄ·Ä¨·Ä∏·Äô·Äª·Ä¨·Ä∏',
          add_entry: '·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏·Äë·Ää·Ä∑·Ä∫·Äô·Ää·Ä∫', add_dayoff: '·Äî·Ä¨·Ä∏·Äõ·ÄÄ·Ä∫', export_csv: 'CSV ·Äë·ÄØ·Äê·Ä∫·Äö·Ä∞·Äô·Ää·Ä∫', print: '·Äï·ÄØ·Ä∂·Äî·Äæ·Ä≠·Äï·Ä∫',
          duration_default: '·ÄÄ·Äº·Ä¨·ÄÅ·Äª·Ä≠·Äî·Ä∫: 00:00 (0.00·Äî·Ä¨·Äõ·ÄÆ)', total_label: '·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏ ·Äï·Äê·Ä∫·Äú·Ää·Ä∫·Äî·Ä¨·Äõ·ÄÆ:', prev: '·Äô·ÄÆ', next: '·Äõ·Äæ·Ä±·Ä∑', today: '·Äö·Äî·Ä±·Ä∑',
          alert_fill: '·Äõ·ÄÄ·Ä∫·ÄÖ·ÄΩ·Ä≤·Åä ·ÄÖ·Äê·ÄÑ·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Ä°·ÄÜ·ÄØ·Ä∂·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´·Åã'
        },
        th: {
          app_title: '‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ß‡∏ô', subtitle: '‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏î‡∏π‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤',
          add_entry: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', add_dayoff: '‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î', export_csv: '‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV', print: '‡∏û‡∏¥‡∏°‡∏û‡πå',
          duration_default: '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: 00:00 (0.00 ‡∏ä‡∏°.)', total_label: '‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©:', prev: '‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤', next: '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ', today: '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
          alert_fill: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å'
        }
      };

      // state
      let entries = [];
      let editId = null;
      let selectedYear, selectedMonth; // integers
      let currentLang = localStorage.getItem(LANG) || 'en';

      // helpers
      function parseHM(t){ if(!t) return null; const [h,m]=t.split(':').map(Number); if(Number.isNaN(h) || Number.isNaN(m)) return null; return h*60+m; }
      function fmtHM(min){ const h=Math.floor(min/60); const m=min%60; return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}` }
      function computeRounded(raw){ if(raw<=0) return 0.00; const h=Math.floor(raw/60); const m=raw%60; let H=h; let M=0; if(m>=1 && m<=29) M=0; else if(m>=30 && m<=39) M=50; else if(m>=40 && m<=59){ M=0; H=h+1; } return +(H + M/60).toFixed(2); }

      function save(){ localStorage.setItem(STORAGE, JSON.stringify(entries)); render(); }
      function load(){ const raw=localStorage.getItem(STORAGE); entries = raw? JSON.parse(raw): []; }

      function startOfMonth(y,m){ return new Date(y,m,1); }
      function monthLabelText(y,m){ const d = new Date(y,m,1); return d.toLocaleString(currentLang==='my'?'en-US':currentLang,{month:'long', year:'numeric'}); }

      function updatePreview(){ const s=startEl.value, e=endEl.value; if(s && e){ const sM=parseHM(s), eM=parseHM(e); if(sM==null||eM==null){ previewEl.textContent = translations[currentLang].duration_default; return; } let diff=eM - sM; if(diff<0) diff += 24*60; previewEl.textContent = `Duration: ${fmtHM(diff)} (${computeRounded(diff).toFixed(2)}h)` } else { previewEl.textContent = translations[currentLang].duration_default } }

      [startEl,endEl].forEach(i=>i.addEventListener('input', updatePreview));

      // rendering filtered by selected month
      function render(){ entriesBody.innerHTML=''; let total=0; const filtered = entries.filter(r=>{
        const d = new Date(r.date);
        return d.getFullYear() === selectedYear && d.getMonth() === selectedMonth;
      });
      // sort by date desc then id
      filtered.sort((a,b)=>{ if(a.date < b.date) return 1; if(a.date > b.date) return -1; return b.id - a.id; });

      for(const row of filtered){ const tr = document.createElement('tr'); if(row.isDayOff) tr.classList.add('day-off'); const start = row.isDayOff? translations[currentLang].add_dayoff : row.start; const end = row.isDayOff? translations[currentLang].add_dayoff : row.end; const duration = row.isDayOff? translations[currentLang].add_dayoff : row.duration; const rounded = row.isDayOff? 0 : row.rounded; tr.innerHTML = `\n          <td>${row.date}</td>\n          <td>${start}</td>\n          <td>${end}</td>\n          <td>${duration}</td>\n          <td>${rounded.toFixed(2)}</td>\n          <td class="${row.isDayOff? 'day-off':''}">${row.task||''}</td>\n          <td class="actions">${row.isDayOff? `<button class=\"chip del\" data-id=\"${row.id}\">Del</button>` : `<button class=\"chip edit\" data-id=\"${row.id}\">Edit</button><button class=\"chip del\" data-id=\"${row.id}\">Delete</button>`}</td>\n        `; entriesBody.appendChild(tr); total += rounded; }

      totalEl.textContent = total.toFixed(2);
      monthLabel.textContent = monthLabelText(selectedYear, selectedMonth);
      // update UI language texts
      applyLanguageTexts();
    }

      // add/update
      addBtn.addEventListener('click', ()=>{
        const date = dateEl.value; const s = startEl.value; const e = endEl.value; const task = taskEl.value.trim();
        if(!date || !s || !e) return alert(translations[currentLang].alert_fill);
        const sM=parseHM(s), eM=parseHM(e); if(sM==null||eM==null) return alert('Invalid time'); let diff = eM - sM; if(diff<0) diff += 24*60; const formatted = fmtHM(diff); const rounded = computeRounded(diff);
        if(editId){ const i = entries.findIndex(x=>x.id===editId); if(i>-1){ entries[i] = { id: editId, date, start: s, end: e, duration: formatted, rounded, task, isDayOff:false }; editId = null; addBtn.textContent = translations[currentLang].add_entry; } }
        else { entries.push({ id: Date.now(), date, start: s, end: e, duration: formatted, rounded, task, isDayOff:false }); }
        formReset(); save();
      });

      function formReset(){ dateEl.valueAsDate = new Date(selectedYear, selectedMonth, new Date().getDate()); startEl.value=''; endEl.value=''; taskEl.value=''; previewEl.textContent = translations[currentLang].duration_default; addBtn.textContent = translations[currentLang].add_entry; }

      // day off
      dayOffBtn.addEventListener('click', ()=>{
        const date = dateEl.value; if(!date) return alert(translations[currentLang].alert_fill);
        const exists = entries.some(x=> x.date===date && x.isDayOff);
        if(exists && !confirm('Day off exists for this date; add another?')) return;
        entries.push({ id: Date.now(), date, start:'', end:'', duration:'00:00', rounded:0, task:translations[currentLang].add_dayoff, isDayOff:true });
        formReset(); save();
      });

      // edit/delete delegation
      entriesBody.addEventListener('click', (ev)=>{
        const idStr = ev.target.getAttribute('data-id'); if(!idStr) return; const id = Number(idStr);
        if(ev.target.classList.contains('del')){ if(!confirm('Delete this entry?')) return; entries = entries.filter(x=> x.id!==id); save(); }
        if(ev.target.classList.contains('edit')){ const idx = entries.findIndex(x=> x.id===id); if(idx===-1) return; const r = entries[idx]; if(r.isDayOff) return alert('Cannot edit Day Off'); dateEl.value = r.date; startEl.value = r.start; endEl.value = r.end; taskEl.value = r.task; editId = id; addBtn.textContent = 'Save'; window.scrollTo({top:0,behavior:'smooth'}); }
      });

      // export CSV (current month)
      exportBtn.addEventListener('click', ()=>{
        const filtered = entries.filter(r=>{ const d=new Date(r.date); return d.getFullYear()===selectedYear && d.getMonth()===selectedMonth; });
        if(filtered.length===0) return alert('No data to export for this month');
        const headers = ['Date','Start','End','Duration','Rounded Hours','Task'];
        let csv = headers.join(',') + '\n';
        filtered.forEach(r=>{ csv += [r.date, r.isDayOff? 'Day Off': r.start, r.isDayOff? 'Day Off': r.end, r.isDayOff? 'Day Off': r.duration, r.isDayOff? '0.00': r.rounded.toFixed(2), `"${(r.task||'').replace(/"/g,'""') }"`].join(',') + '\n'; });
        csv += `\n${translations['en'].total_label},,, ,${totalEl.textContent}\n`;
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download = `VannTrack_${selectedYear}-${String(selectedMonth+1).padStart(2,'0')}.csv`; document.body.appendChild(a); a.click(); a.remove();
      });

      // print
      printBtn.addEventListener('click', ()=> window.print());

      // month navigation
      prevMonthBtn.addEventListener('click', ()=>{ selectedMonth--; if(selectedMonth<0){ selectedMonth=11; selectedYear--; } localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });
      nextMonthBtn.addEventListener('click', ()=>{ selectedMonth++; if(selectedMonth>11){ selectedMonth=0; selectedYear++; } localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });
      todayMonthBtn.addEventListener('click', ()=>{ const now=new Date(); selectedYear=now.getFullYear(); selectedMonth=now.getMonth(); localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });

      // theme
      function applyTheme(){ const t = localStorage.getItem(THEME) || 'dark'; if(t==='light'){ document.body.classList.add('light-mode'); themeLabel.textContent='Light'; themeToggle.textContent='‚òÄÔ∏è'; } else { document.body.classList.remove('light-mode'); themeLabel.textContent='Dark'; themeToggle.textContent='üåô'; } }
      themeToggle.addEventListener('click', ()=>{ const now = document.body.classList.toggle('light-mode')? 'light':'dark'; localStorage.setItem(THEME, now); applyTheme(); });

      // language
      function applyLanguageTexts(){ const t = translations[currentLang]; document.getElementById('app-title').textContent = t.app_title; document.getElementById('app-sub').textContent = t.subtitle; addBtn.textContent = t.add_entry; dayOffBtn.textContent = t.add_dayoff; exportBtn.textContent = t.export_csv; printBtn.textContent = t.print; previewEl.textContent = translations[currentLang].duration_default; document.getElementById('total-card').firstChild && null; document.getElementById('total-card').innerHTML = `${t.total_label} <span id="total">${totalEl.textContent}</span>`; }

      langButtons.addEventListener('click', (ev)=>{ const b = ev.target; const lang = b && b.getAttribute && b.getAttribute('data-lang'); if(!lang) return; currentLang = (lang==='mm')? 'my' : lang; localStorage.setItem(LANG,currentLang); render(); });

      // init
      function init(){ load(); // determine month to show
        const saved = localStorage.getItem(MONTH); if(saved){ try{ const o=JSON.parse(saved); selectedYear=o.y; selectedMonth=o.m; }catch(e){ /* ignore */ } }
        if(typeof selectedYear === 'undefined'){ const now=new Date(); selectedYear = now.getFullYear(); selectedMonth = now.getMonth(); }
        // set date input default to first day of selected month
        dateEl.valueAsDate = new Date(selectedYear, selectedMonth, Math.min(new Date().getDate(),28));
        currentLang = localStorage.getItem(LANG) || currentLang;
        applyLanguageTexts(); applyTheme(); render();
      }

      init();

    })();
  </script>
</body>
</html>
