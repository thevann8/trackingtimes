<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TheVann Track Duration â€” v7</title>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3313525409837398" crossorigin="anonymous"></script>

  <style>
    .btn {
      padding: 10px 16px;
      background: #08b6d8;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>

<div style="text-align:center; margin-top:20px;">
  <button id="signInBtn" class="btn">Sign in with Google</button>
  <button id="signOutBtn" class="btn" style="display:none;">Sign Out</button>
  <p id="userInfo" style="margin-top:10px; color:lime;"></p>
</div>


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>The Vann Track Duration â€” v7 (mobile-ready)</title>
  <meta name="description" content="Track work time with custom rounding, month view, multi-language, dark/light theme, CSV, print-ready and AdSense ready." />

  <!-- Google AdSense (as requested) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3313525409837398"
     crossorigin="anonymous"></script>

  <style>
    :root{
      --bg-dark: #071124;
      --card-dark: #071a2a;
      --navy: #04263a;
      --cyan: #08b6d8;
      --muted-dark: #9fb7c6;
      --text-dark: #e6f7fb;
      --glass: rgba(255,255,255,0.03);
      --success: #16a34a;
      --danger: #ef4444;
      --radius: 12px;
      --shadow: 0 12px 30px rgba(2,6,23,0.55);
      --table-border-dark: rgba(255,255,255,0.04);
      --font: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    body.light-mode{
      --bg-dark: #f7fbfc;
      --card-dark: #ffffff;
      --navy: #042a4b;
      --cyan: #06b6d4;
      --muted-dark: #4b5563;
      --text-dark: #071124;
      --glass: rgba(2,6,23,0.03);
      --shadow: 0 10px 24px rgba(2,6,23,0.08);
      --table-border-dark: rgba(2,6,23,0.06);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg-dark);color:var(--text-dark);font-family:var(--font);-webkit-font-smoothing:antialiased}
    .wrap{max-width:980px;margin:18px auto;padding:0 14px}
    .card{background:linear-gradient(180deg,var(--card-dark), rgba(255,255,255,0.01));padding:16px;border-radius:14px;box-shadow:var(--shadow);border:1px solid var(--glass)}
    header.app-head{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .title-wrap{display:flex;flex-direction:column;min-width:140px}
    h1.title{margin:0;font-size:18px;letter-spacing:0.2px}
    .subtitle{color:var(--muted-dark);font-size:12px;margin-top:4px}

    /* top row: language + theme */
    .controls-top-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .lang-select{display:flex;gap:6px}
    .lang-btn{background:transparent;border:1px solid var(--table-border-dark);color:var(--text-dark);padding:6px 10px;border-radius:10px;cursor:pointer;font-size:13px}
    .theme-toggle{background:var(--navy);color:white;border-radius:10px;padding:6px 10px;border:none;cursor:pointer;font-weight:600}

    /* month navigation */
    .month-nav{display:flex;align-items:center;gap:8px;margin-top:12px}
    .month-btn{background:transparent;border:1px solid var(--table-border-dark);color:var(--text-dark);padding:8px 10px;border-radius:10px;cursor:pointer}
    .month-label{font-weight:700;font-size:15px;color:var(--text-dark)}

    /* form / inputs (mobile-first, stacked) */
    .form-row{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .inputs{display:flex;flex-direction:column;gap:8px}
    input[type=date], input[type=time], input[type=text]{
      width:100%;padding:12px;border-radius:10px;border:1px solid var(--table-border-dark);background:transparent;color:var(--text-dark);font-size:15px
    }
    .preview{font-size:13px;color:var(--muted-dark);padding:8px 10px;border-radius:8px;background:transparent}

    /* action button row (stacked on mobile, row on desktop) */
    .actions-row{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .actions-row .row{display:flex;gap:8px}
    .btn{
      border-radius:10px;padding:12px 14px;border:none;cursor:pointer;font-weight:700;font-size:15px;
      box-shadow: 0 6px 16px rgba(2,6,23,0.18);
    }
    .btn.primary{background:linear-gradient(90deg,var(--cyan),#38e6f0);color:#012;flex:1}
    .btn.ghost{background:transparent;border:1px solid var(--table-border-dark);color:var(--text-dark);flex:1}

    /* table area */
    .table-wrap{overflow:auto;margin-top:12px;border-radius:10px}
    table{width:100%;border-collapse:collapse;min-width:680px}
    thead th{background:transparent;color:var(--muted-dark);text-transform:uppercase;font-size:12px;padding:10px 8px;border-bottom:1px solid var(--table-border-dark);text-align:left}
    tbody td{padding:10px 8px;border-bottom:1px solid var(--table-border-dark);font-size:14px}
    tbody tr:nth-child(odd){background:rgba(255,255,255,0.02)}
    tr.day-off td{font-style:italic;color:var(--muted-dark)}

    .actions{display:flex;gap:6px}
    .chip{padding:8px 10px;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;border:none}
    .chip.edit{background:var(--success);color:#fff}
    .chip.del{background:var(--danger);color:#fff}

    .total-wrap{display:flex;justify-content:center;margin-top:14px}
    .total-card{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px 16px;border-radius:12px;font-weight:800;color:var(--text-dark)}

    /* desktop: make inputs row */
    @media(min-width:680px){
      .form-row{gap:12px}
      .inputs{flex-direction:row;align-items:center}
      input[type=date], input[type=time], input[type=text]{flex:0 0 auto;min-width:150px;width:auto}
      .actions-row{flex-direction:row}
      .controls-top-row{gap:12px}
      .lang-select{gap:8px}
    }

    /* small phones */
    @media(max-width:380px){
      input[type=date], input[type=time], input[type=text]{font-size:14px;padding:10px}
      .btn{padding:10px;font-size:14px}
      thead th, tbody td{font-size:13px;padding:8px}
      .title-wrap h1{font-size:17px}
    }

    /* print */
    @media print{
      @page{size:A4 landscape;margin:12mm}
      body,html{background:#fff;color:#000}
      .card{background:#fff;box-shadow:none;border:none}
      .controls-top-row, .lang-select, .chip, .btn, .actions-row{display:none!important}
      table{width:100%;border-collapse:collapse}
      thead th, tbody td{border:1px solid #ccc;padding:8px;color:#000;background:#fff}
      thead th{background:#f2f2f2}
      td.actions{display:none}
      .total-card{background:transparent;color:#000}
    }
  </style>
</head>
<body>
  <!-- âœ… Google Sign-in Buttons -->
  <div style="text-align:center; margin-top:20px;">
    <button id="signInBtn" class="btn">Sign in with Google</button>
    <button id="signOutBtn" class="btn" style="display:none;">Sign Out</button>
    <p id="userInfo" style="margin-top:10px; color:lime;"></p>
  </div>

  <!-- Your existing tracker app here -->

  <div class="wrap">
    <div class="card" role="application" aria-labelledby="app-title">
      <header class="app-head">
        <div class="title-wrap">
          <h1 class="title" id="app-title">TheVann Track Duration</h1>
          <div class="subtitle" id="app-sub">Auto rounding, monthly view, multi-language</div>
        </div>

        <div class="controls-top-row" aria-hidden="false">
          <div class="lang-select" id="lang-buttons" role="tablist" aria-label="Language selector">
            <button class="lang-btn" data-lang="en" aria-pressed="true">English</button>
            <button class="lang-btn" data-lang="my">á€™á€¼á€”á€ºá€™á€¬</button>
            <button class="lang-btn" data-lang="th">à¹„à¸—à¸¢</button>
          </div>

          <button id="theme-toggle" class="theme-toggle" title="Toggle theme">ðŸŒ™</button>
        </div>
      </header>

      <div class="month-nav" style="margin-top:12px">
        <button id="prev-month" class="month-btn">â—€</button>
        <div class="month-label" id="month-label">Month</div>
        <button id="next-month" class="month-btn">â–¶</button>
        <button id="today-month" class="month-btn" style="margin-left:8px">Today</button>

        <div style="margin-left:auto;display:flex;gap:8px">
          <button id="export-csv" class="month-btn">Export CSV</button>
          <button id="print-btn" class="month-btn">Print</button>
        </div>
      </div>

      <form id="entry-form" class="form-row" onsubmit="return false;">
        <div class="inputs" role="group" aria-label="Entry inputs">
          <input id="date-input" type="date" required aria-label="Date" />
          <input id="start-input" type="time" required aria-label="Start time" />
          <input id="end-input" type="time" required aria-label="End time" />
          <input id="task-input" type="text" placeholder="Task / notes (optional)" aria-label="Task notes" />
        </div>

        <div style="margin-top:6px" class="preview" id="preview">Duration: 00:00 (0.00h)</div>

        <div class="actions-row" aria-hidden="false">
          <div class="row">
            <button id="add-btn" class="btn primary" type="button">Add Entry</button>
            <button id="dayoff-btn" class="btn ghost" type="button">Add Day Off</button>
          </div>
        </div>
      </form>

      <div class="table-wrap" role="region" aria-label="Entries table">
        <table id="entries-table" role="table" aria-describedby="month-label">
          <thead role="rowgroup">
            <tr role="row">
              <th role="columnheader">Date</th>
              <th role="columnheader">Start</th>
              <th role="columnheader">End</th>
              <th role="columnheader">Duration (H:M)</th>
              <th role="columnheader">Rounded (hrs)</th>
              <th role="columnheader">Task</th>
              <th role="columnheader" class="actions">Actions</th>
            </tr>
          </thead>
          <tbody id="entries-body" role="rowgroup"></tbody>
        </table>
      </div>

      <div class="total-wrap">
        <div class="total-card" id="total-card">Total Rounded Hours: <strong id="total">0.00</strong></div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // keys
    const STORAGE = 'vann_v7_entries';
    const THEME = 'vann_v7_theme';
    const LANG = 'vann_v7_lang';
    const MONTH = 'vann_v7_month';

    // elements
    const dateEl = document.getElementById('date-input');
    const startEl = document.getElementById('start-input');
    const endEl = document.getElementById('end-input');
    const taskEl = document.getElementById('task-input');
    const previewEl = document.getElementById('preview');
    const addBtn = document.getElementById('add-btn');
    const dayOffBtn = document.getElementById('dayoff-btn');
    const entriesBody = document.getElementById('entries-body');
    const totalEl = document.getElementById('total');
    const exportBtn = document.getElementById('export-csv');
    const printBtn = document.getElementById('print-btn');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');
    const todayMonthBtn = document.getElementById('today-month');
    const monthLabel = document.getElementById('month-label');
    const langButtons = document.getElementById('lang-buttons');
    const themeToggle = document.getElementById('theme-toggle');
    const themeLabel = document.getElementById('app-sub');

    // translations
    const translations = {
      en: {
        app_title: 'TheVann Track Duration',
        subtitle: 'Auto rounding, monthly view, multi-language',
        add_entry: 'Add Entry',
        add_dayoff: 'Add Day Off',
        export_csv: 'Export CSV',
        print: 'Print',
        duration_default: 'Duration: 00:00 (0.00h)',
        total_label: 'Total Rounded Hours:',
        prev: 'Prev',
        next: 'Next',
        today: 'Today',
        alert_fill: 'Please fill Date, Start and End.'
      },
      my: {
        app_title: 'Thevann á€¡á€á€»á€­á€”á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸',
        subtitle: 'á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º á€•á€á€ºá€œá€Šá€ºá€…á€®á€…á€…á€ºá€á€¼á€„á€ºá€¸áŠ á€œá€…á€‰á€º á€€á€¼á€Šá€·á€ºá€›á€¾á€¯á€™á€¾á€¯áŠ á€˜á€¬á€žá€¬á€…á€€á€¬á€¸á€™á€»á€¬á€¸',
        add_entry: 'á€™á€¾á€á€ºá€á€™á€ºá€¸á€‘á€Šá€·á€ºá€™á€Šá€º',
        add_dayoff: 'á€”á€¬á€¸á€›á€€á€º',
        export_csv: 'CSV á€‘á€¯á€á€ºá€šá€°á€™á€Šá€º',
        print: 'á€•á€¯á€¶á€”á€¾á€­á€•á€º',
        duration_default: 'á€€á€¼á€¬á€á€»á€­á€”á€º: 00:00 (0.00á€”á€¬á€›á€®)',
        total_label: 'á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ á€•á€á€ºá€œá€Šá€ºá€”á€¬á€›á€®:',
        prev: 'á€™á€®',
        next: 'á€›á€¾á€±á€·',
        today: 'á€šá€”á€±á€·',
        alert_fill: 'á€›á€€á€ºá€…á€½á€²áŠ á€…á€á€„á€ºá€”á€¾á€„á€·á€º á€¡á€†á€¯á€¶á€¸á€á€»á€­á€”á€º á€‘á€Šá€·á€ºá€•á€«á‹'
      },
      th: {
        app_title: 'à¸•à¸±à¸§à¸ˆà¸±à¸šà¹€à¸§à¸¥à¸²à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡à¹à¸§à¸™',
        subtitle: 'à¸à¸²à¸£à¸›à¸±à¸”à¹€à¸§à¸¥à¸²à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ à¸”à¸¹à¸•à¸²à¸¡à¹€à¸”à¸·à¸­à¸™ à¸£à¸­à¸‡à¸£à¸±à¸šà¸«à¸¥à¸²à¸¢à¸ à¸²à¸©à¸²',
        add_entry: 'à¹€à¸žà¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£',
        add_dayoff: 'à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”',
        export_csv: 'à¸ªà¹ˆà¸‡à¸­à¸­à¸ CSV',
        print: 'à¸žà¸´à¸¡à¸žà¹Œ',
        duration_default: 'à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²: 00:00 (0.00 à¸Šà¸¡.)',
        total_label: 'à¸£à¸§à¸¡à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸›à¸±à¸”à¹€à¸¨à¸©:',
        prev: 'à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²',
        next: 'à¸–à¸±à¸”à¹„à¸›',
        today: 'à¸§à¸±à¸™à¸™à¸µà¹‰',
        alert_fill: 'à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ à¹€à¸§à¸¥à¸²à¹€à¸‚à¹‰à¸² à¹à¸¥à¸° à¹€à¸§à¸¥à¸²à¸­à¸­à¸'
      }
    };

    // state
    let entries = [];
    let editId = null;
    let selectedYear, selectedMonth;
    let currentLang = localStorage.getItem(LANG) || 'en';

    // helpers
    function parseHM(t){ if(!t) return null; const [h,m]=t.split(':').map(Number); if(Number.isNaN(h)||Number.isNaN(m)) return null; return h*60+m; }
    function fmtHM(min){ const h=Math.floor(min/60); const m=min%60; return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`; }
    // rounding rule: 1-29 -> 00, 30-39 -> 50, 40-59 -> next hour
    function computeRounded(raw){ if(raw<=0) return 0.00; const h=Math.floor(raw/60); const m=raw%60; let H=h; let M=0; if(m>=1 && m<=29) M=0; else if(m>=30 && m<=39) M=50; else if(m>=40 && m<=59){ M=0; H=h+1; } return +(H + M/60).toFixed(2); }

    function save(){ localStorage.setItem(STORAGE, JSON.stringify(entries)); render(); }
    function load(){ const raw=localStorage.getItem(STORAGE); entries = raw? JSON.parse(raw): []; }

    function monthLabelText(y,m){
      const d = new Date(y,m,1);
      // use en-US for Burmese locale to keep English month names consistent
      return d.toLocaleString(currentLang==='my'?'en-US':currentLang, { month: 'long', year: 'numeric' });
    }

    function updatePreview(){
      const s=startEl.value, e=endEl.value;
      if(s && e){
        const sM=parseHM(s), eM=parseHM(e);
        if(sM==null||eM==null){ previewEl.textContent = translations[currentLang].duration_default; return; }
        let diff = eM - sM;
        if(diff<0) diff += 24*60;
        previewEl.textContent = `Duration: ${fmtHM(diff)} (${computeRounded(diff).toFixed(2)}h)`;
      } else {
        previewEl.textContent = translations[currentLang].duration_default;
      }
    }
    [startEl,endEl].forEach(i=>i.addEventListener('input', updatePreview));

    // render filtered by selected month
    function render(){
      entriesBody.innerHTML = '';
      let total=0;
      const filtered = entries.filter(r=>{
        const d = new Date(r.date);
        return d.getFullYear() === selectedYear && d.getMonth() === selectedMonth;
      });

      filtered.sort((a,b)=>{
        if(a.date < b.date) return 1;
        if(a.date > b.date) return -1;
        return b.id - a.id;
      });

      for(const row of filtered){
        const tr = document.createElement('tr');
        if(row.isDayOff) tr.classList.add('day-off');
        const start = row.isDayOff? translations[currentLang].add_dayoff : row.start;
        const end = row.isDayOff? translations[currentLang].add_dayoff : row.end;
        const duration = row.isDayOff? translations[currentLang].add_dayoff : row.duration;
        const rounded = row.isDayOff? 0 : row.rounded;
        tr.innerHTML = `
          <td>${row.date}</td>
          <td>${start}</td>
          <td>${end}</td>
          <td>${duration}</td>
          <td>${rounded.toFixed(2)}</td>
          <td class="${row.isDayOff? 'day-off':''}">${row.task||''}</td>
          <td class="actions">${row.isDayOff? `<button class="chip del" data-id="${row.id}">Del</button>` : `<button class="chip edit" data-id="${row.id}">Edit</button><button class="chip del" data-id="${row.id}">Delete</button>`}</td>
        `;
        entriesBody.appendChild(tr);
        total += rounded;
      }

      totalEl.textContent = total.toFixed(2);
      monthLabel.textContent = monthLabelText(selectedYear, selectedMonth);
      applyLanguageTexts(); // ensure UI text updates
    }

    // add / update
    addBtn.addEventListener('click', ()=>{
      const date = dateEl.value; const s = startEl.value; const e = endEl.value; const task = taskEl.value.trim();
      if(!date || !s || !e) return alert(translations[currentLang].alert_fill);
      const sM = parseHM(s), eM = parseHM(e);
      if(sM==null || eM==null) return alert('Invalid time');
      let diff = eM - sM;
      if(diff < 0) diff += 24*60;
      const formatted = fmtHM(diff); const rounded = computeRounded(diff);
      if(editId){
        const i = entries.findIndex(x => x.id === editId);
        if(i>-1){
          entries[i] = { id: editId, date, start: s, end: e, duration: formatted, rounded, task, isDayOff: false };
          editId = null; addBtn.textContent = translations[currentLang].add_entry;
        }
      } else {
        entries.push({ id: Date.now(), date, start: s, end: e, duration: formatted, rounded, task, isDayOff: false });
      }
      formReset(); save();
    });

    function formReset(){
      const now = new Date();
      dateEl.valueAsDate = new Date(selectedYear, selectedMonth, Math.min(now.getDate(), 28));
      startEl.value = ''; endEl.value = ''; taskEl.value = '';
      previewEl.textContent = translations[currentLang].duration_default;
      addBtn.textContent = translations[currentLang].add_entry;
    }

    // day off
    dayOffBtn.addEventListener('click', ()=>{
      const date = dateEl.value;
      if(!date) return alert(translations[currentLang].alert_fill);
      const exists = entries.some(x => x.date === date && x.isDayOff);
      if(exists && !confirm('Day off exists for this date; add another?')) return;
      entries.push({ id: Date.now(), date, start:'', end:'', duration:'00:00', rounded:0, task: translations[currentLang].add_dayoff, isDayOff: true });
      formReset(); save();
    });

    // edit/delete delegation
    entriesBody.addEventListener('click', (ev)=>{
      const idStr = ev.target.getAttribute('data-id'); if(!idStr) return; const id = Number(idStr);
      if(ev.target.classList.contains('del')){ if(!confirm('Delete this entry?')) return; entries = entries.filter(x => x.id !== id); save(); }
      if(ev.target.classList.contains('edit')){ const idx = entries.findIndex(x => x.id === id); if(idx === -1) return; const r = entries[idx]; if(r.isDayOff) return alert('Cannot edit Day Off'); dateEl.value = r.date; startEl.value = r.start; endEl.value = r.end; taskEl.value = r.task; editId = id; addBtn.textContent = 'Save'; window.scrollTo({top:0,behavior:'smooth'}); }
    });

    // export CSV (current month)
    exportBtn.addEventListener('click', ()=>{
      const filtered = entries.filter(r => { const d = new Date(r.date); return d.getFullYear() === selectedYear && d.getMonth() === selectedMonth; });
      if(filtered.length === 0) return alert('No data to export for this month');
      const headers = ['Date','Start','End','Duration','Rounded Hours','Task'];
      let csv = headers.join(',') + '\n';
      filtered.forEach(r => {
        csv += [ r.date, r.isDayOff? 'Day Off' : r.start, r.isDayOff? 'Day Off' : r.end, r.isDayOff? 'Day Off' : r.duration, r.isDayOff? '0.00' : r.rounded.toFixed(2), `"${(r.task||'').replace(/"/g,'""')}"` ].join(',') + '\n';
      });
      csv += `\n${translations['en'].total_label},,, ,${totalEl.textContent}\n`;
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `VannTrack_${selectedYear}-${String(selectedMonth+1).padStart(2,'0')}.csv`; document.body.appendChild(a); a.click(); a.remove();
    });

    // print
    printBtn.addEventListener('click', ()=> window.print());

    // month navigation
    prevMonthBtn.addEventListener('click', ()=>{ selectedMonth--; if(selectedMonth < 0){ selectedMonth = 11; selectedYear--; } localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });
    nextMonthBtn.addEventListener('click', ()=>{ selectedMonth++; if(selectedMonth > 11){ selectedMonth = 0; selectedYear++; } localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });
    todayMonthBtn.addEventListener('click', ()=>{ const now = new Date(); selectedYear = now.getFullYear(); selectedMonth = now.getMonth(); localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });

    // theme toggle
    function applyTheme(){ const t = localStorage.getItem(THEME) || 'dark'; if(t === 'light'){ document.body.classList.add('light-mode'); themeToggle.textContent = 'â˜€ï¸'; } else { document.body.classList.remove('light-mode'); themeToggle.textContent = 'ðŸŒ™'; } }
    themeToggle.addEventListener('click', ()=>{ const now = document.body.classList.toggle('light-mode') ? 'light' : 'dark'; localStorage.setItem(THEME, now); applyTheme(); });

    // language
    function applyLanguageTexts(){
      const t = translations[currentLang];
      document.getElementById('app-title').textContent = t.app_title;
      document.getElementById('app-sub').textContent = t.subtitle;
      addBtn.textContent = t.add_entry;
      dayOffBtn.textContent = t.add_dayoff;
      exportBtn.textContent = t.export_csv;
      printBtn.textContent = t.print;
      previewEl.textContent = t.duration_default;
      document.getElementById('total-card').innerHTML = `${t.total_label} <strong id="total">${totalEl.textContent}</strong>`;
    }

    langButtons.addEventListener('click', (ev)=>{
      const b = ev.target; const lang = b && b.getAttribute && b.getAttribute('data-lang'); if(!lang) return;
      currentLang = (lang === 'mm') ? 'my' : lang; // support mm alias
      localStorage.setItem(LANG, currentLang);
      render();
    });

    // init
    function init(){
      load();
      const saved = localStorage.getItem(MONTH);
      if(saved){
        try{ const o = JSON.parse(saved); selectedYear = o.y; selectedMonth = o.m; } catch(e){ /* ignore */ }
      }
      if(typeof selectedYear === 'undefined'){
        const now = new Date(); selectedYear = now.getFullYear(); selectedMonth = now.getMonth();
      }
      // set date input default to today's date (within selected month)
      const now = new Date();
      dateEl.valueAsDate = new Date(selectedYear, selectedMonth, Math.min(now.getDate(), 28));
      currentLang = localStorage.getItem(LANG) || currentLang;
      applyTheme();
      applyLanguageTexts();
      render();
    }

    init();
  })();

  </script><script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBPt8cZMMW6gs8TLV-7EEvpJJVZ33DH23k",
    authDomain: "thevanntrackduration-81ee0.firebaseapp.com",
    projectId: "thevanntrackduration-81ee0",
    storageBucket: "thevanntrackduration-81ee0.firebasestorage.app",
    messagingSenderId: "56786707859",
    appId: "1:56786707859:web:75be757ceb95604984f466",
    measurementId: "G-QNG2F09LWL"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const analytics = getAnalytics(app);

  // Buttons
  const signInBtn = document.getElementById("signInBtn");
  const signOutBtn = document.getElementById("signOutBtn");
  const userInfo = document.getElementById("userInfo");

  // Sign in
  signInBtn.addEventListener("click", async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;
      userInfo.innerHTML = `âœ… Signed in as <b>${user.displayName}</b>`;
      signInBtn.style.display = "none";
      signOutBtn.style.display = "inline-block";
    } catch (error) {
      alert("Login failed: " + error.message);
    }
  });

  // Sign out
  signOutBtn.addEventListener("click", async () => {
    await signOut(auth);
    userInfo.innerHTML = "";
    signInBtn.style.display = "inline-block";
    signOutBtn.style.display = "none";
  });
</script>

</body>
</html>
