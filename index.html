<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>TheVann Track Duration — v8 (Google sign-in)</title>
  <meta name="description" content="Track work time with custom rounding, month view, multi-language, dark/light theme, CSV, print-ready and Google sign-in." />

  <style>
    /* Theme Variables */
    :root{
      --bg:#071226; --card:#0b1724; --text:#eaf6fb; --muted:#9fb7c6;
      --accent:#06c2d6; --accent-2:#2dd4bf; --success:#16a34a; --danger:#ef4444;
      --glass:rgba(255,255,255,0.03); --radius:12px; --shadow:0 12px 30px rgba(3,8,20,0.6);
      --table-border:rgba(255,255,255,0.04); --input-bg:rgba(255,255,255,0.04);
      --dayoff-bg: rgba(239, 68, 68, 0.15); --dayoff-border: #ef4444; --dayoff-text: #ffcfcf;
      --earnings-color: #fbbd0a; --advance-color: #f472b6; --net-earnings-color: var(--success);
    }
    body.light-mode{
      --bg:#f7fbfc;--card:#fff;--text:#06202a;--muted:#4b5963;--accent:#0ea5a3;--accent-2:#7dd3fc;
      --glass:rgba(2,6,23,0.03);--shadow:0 8px 20px rgba(2,6,23,0.06);--table-border:rgba(2,6,23,0.06);
      --dayoff-bg: #fff0f0; --dayoff-border: #cc3333; --dayoff-text: #cc3333;
      --earnings-color: #e38200; --advance-color: #db2777; --net-earnings-color: var(--success);
    }

    /* General Styles */
    *{box-sizing:border-box; transition: all 0.3s ease-in-out;}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Roboto,Arial;padding:14px}
    .wrap{max-width:980px;margin:0 auto}
    .card{background:linear-gradient(180deg,var(--card),rgba(255,255,255,0.02));padding:16px;border-radius:14px;box-shadow:var(--shadow);border:1px solid var(--glass)}

    /* App Header */
    header.app-head{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:8px; position: relative; padding-top: 50px;}
    .title-wrap { display: flex; align-items: center; gap: 10px; flex: 1; min-width: 180px; }
    #app-logo { width: 36px; height: 36px; border-radius: 8px; object-fit: cover; flex-shrink: 0; }
    h1.title{margin: 0; font-size:18px}
    .subtitle{color:var(--muted);font-size:12px;margin-top:4px}

    /* =================================
       REDESIGNED: AUTH AREA
    ================================= */
    .auth-area{
        display:flex; flex-direction:column; align-items:center; justify-content:center;
        min-height:calc(100vh - 28px); margin:-14px; padding: 20px; gap: 20px;
    }
    /* UPDATED: Auth Logo Size */
    #auth-logo { 
        width: 80px; /* Increased size */
        height: 80px; /* Increased size */
        border-radius: 50%; object-fit: cover; display: block;
    }
    .auth-area-title { font-size: 24px; margin: 0; color: var(--text); text-align: center; }
    .auth-controls { display: flex; justify-content: center; align-items: center; gap: 15px; }

    .auth-card {
        background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--glass);
        padding: 24px 28px; width: 100%; max-width: 400px; animation: fadeIn 0.5s ease-out;
    }
    body.light-mode .auth-card { background: #fff; border-color: #e8e8e8; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .auth-pane-sub { font-size: 14px; color: var(--muted); text-align: center; margin-top: 0; margin-bottom: 20px; }
    .auth-card .auth-btn { width: 100%; max-width: 100%; justify-content: center; padding: 10px 18px; border-radius: 18px; border: none; font-weight: 700; cursor: pointer; display: flex; align-items: center; }
    .auth-card .input-group { width: 100%; max-width: 100%; margin-bottom: 15px; }
    .auth-card .input-group:last-of-type { margin-bottom: 20px; }
    .auth-card .input-group input, .auth-area input[type=email], .auth-area input[type=password], .auth-area input[type=text] { 
        width: 100%; min-width: unset; background: var(--input-bg); 
        border: 1px solid var(--table-border);
    }
    body.light-mode .auth-card .input-group input { background: #f9f9f9; border-color: #ddd; color: var(--text); }

    .auth-btn.primary { justify-content: center; background: var(--accent); color: #022; box-shadow:0 6px 18px rgba(0,0,0,0.25); }
    body.light-mode .auth-btn.primary { background: var(--accent); }

    /* FIXED: Google Button + Icon Styles */
    .auth-btn.google-btn {
        background: var(--card); color: var(--text); border: 1px solid var(--table-border);
        box-shadow: none; 
    }
    body.light-mode .auth-btn.google-btn { background: #fff; color: #333; border-color: #ccc; }
    .auth-btn .google-icon {
        width: 18px; height: 18px; margin-right: 10px; background-size: contain; background-repeat: no-repeat;
        /* Standard Google G Logo Base64 */
        background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5LjJWMEg5LjJ2OS4ySDB2MS44aDkuMnY5LjJoMS44di05LjJIMTguMVY5LjJ6IiBmaWxsPSIjNDE4NUY0Ii8+PHBhdGggZD0iTTkuMiAxOC40YzIuNCAwIDQuNS0uOCA1LjktMi4ybC0xLjYtMS4yYy0uOC41LTIuMS44LTMuMy44LTIuNiAwLTQuNy0xLjgtNS41LTMuOUgwbDMuMyA5LjJ6IiBmaWxsPSIjMzRBODUzIi8+PHBhdGggZD0iTTMuNyAxMC45Yy0uMy0uOC0uNC0xLjgtLjQtMi45IDAtMS4xLjEtMi4xLjQtMi45TDAsMy44QzAgNS40IDAgNy42IDAgOS4yczAgMy45IDAgNS41bDMuNy0xLjJ6IiBmaWxsPSIjRkJCQzA1Ii8+PHBhdGggZD0iTTkuMiAzLjZjMS4yIDAgMi4zLjQgMy4yIDEuM2wxLjMtMS4zQzEyLjQgMS42IDEwLjkgMS4xIDkuMiAxLjEgNS4yIDEuMSAyLjEgMy43IDAgNy42bDMuNyAxLjJjLjgtMi4xIDMtMy45IDUuNS0zLjloLjB6IiBmaWxsPSIjRUE0MzM1Ii8+PC9nPjwvc3ZnPg==');
        /* Explicitly remove any background color/borders */
        background-color: transparent;
        border: none;
        padding: 0;
    }
    
    .auth-divider { display: flex; align-items: center; text-align: center; color: var(--muted); font-size: 12px; font-weight: 600; margin: 20px 0; }
    .auth-divider::before, .auth-divider::after { content: ''; flex: 1; border-bottom: 1px solid var(--table-border); }
    .auth-divider span { padding: 0 10px; }
    
    .auth-switch-link { color: var(--accent); font-size: 14px; cursor: pointer; margin-top: 20px; text-align: center; display: block; }
    .auth-switch-link:hover { color: var(--accent-2); }
    .forgot-password-link { color: var(--muted); font-size: 13px; text-align: right; display: block; margin-top: -10px; margin-bottom: 20px; cursor: pointer;}
    .forgot-password-link:hover { color: var(--text); }
    
    .auth-terms-footer { font-size: 12px; color: var(--muted); text-align: center; line-height: 1.5; margin-top: 20px; }
    .auth-terms-footer a { color: var(--accent); text-decoration: none; }
    .auth-terms-footer a:hover { text-decoration: underline; }
    /* ================================= */

    /* Signed State */
    #signedState { display: none; position: absolute; top: 0px; right: 0px; padding: 8px 12px; background: var(--card); border-bottom-left-radius: 12px; box-shadow: 0 1px 5px rgba(0,0,0,0.2); flex-direction: row; align-items: center; gap: 8px; z-index: 1000; }
    .signed-as{color:var(--success);font-weight:700;font-size:13px; white-space: nowrap;}
    .auth-btn.secondary{ background: var(--danger); color: #fff; border: 1px solid var(--danger); padding: 4px 8px; font-size: 12px; margin-bottom: 0; }
    .auth-btn.secondary:hover { background: #cc3333; border-color: #cc3333; }

    /* Right Controls (App Header) & Auth Controls */
    .right-controls, .auth-controls {display:flex;align-items:center;gap:8px}
    .lang-select{display:flex;gap:6px}
    .lang-select button{background:transparent;border:1px solid var(--table-border);padding:6px 8px;border-radius:8px;color:var(--text);cursor:pointer;font-size:13px}
    body.light-mode .lang-select button { border-color: #ccc; }
    .toggle{background:transparent;border:1px solid var(--table-border);padding:6px 8px;border-radius:8px;cursor:pointer}
    body.light-mode .toggle { border-color: #ccc; }
    #admin-menu-btn { background: var(--danger); color: #fff; font-size: 16px; display: none; }
    #admin-menu-btn:hover { background: #cc3333; }

    /* Input Groups & General Inputs/Buttons */
    .input-group label { color: var(--muted); font-size: 12px; font-weight: 600; text-transform: uppercase; margin-left: 0; margin-bottom: 2px; }
    .input-group { display: flex; flex-direction: column; gap: 0; }
    input[type=date],input[type=time],input[type=text],input[type=number],input[type=email],input[type=password]{background:transparent;border:1px solid var(--table-border);padding:8px 10px;border-radius:8px;color:var(--text);min-width:120px}
    input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
    .btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
    .primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#022}
    .ghost{background:transparent;border:1px solid var(--table-border);color:var(--text)}
    .visibility-toggle { background: transparent; border: none; cursor: pointer; font-size: 18px; padding: 0 2px; color: var(--muted); line-height: 1; margin-left: 5px; }
    .visibility-toggle:hover { color: var(--text); }

    /* Top Controls Area (App Content) */
    .controls-top{ display:flex; flex-wrap:wrap; gap:8px; align-items: center; margin-top:12px; justify-content: space-between; }
    .month-nav-controls { display: flex; gap: 8px; align-items: center; flex-grow: 1; justify-content: center; min-width: 280px; }
    #month-label { font-weight:700; min-width:140px; text-align:center; flex-shrink: 0; }
    .month-nav-controls .btn { padding: 8px 10px; }
    .totals-controls { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .export-print-controls { display: flex; gap: 8px; margin-left: auto; }
    .total-card{ background:var(--input-bg); padding:10px 15px; border-radius:8px; color:var(--text); font-weight:700; font-size: 15px; display: flex; align-items: center; justify-content: space-between; gap: 8px;}
    .total-card span#total { color: var(--accent); font-size: 16px;}

    /* Earnings Display */
    #earnings-display { background: var(--input-bg); padding: 10px 15px; border-radius: 8px; color: var(--text); font-weight: 700; font-size: 15px; border: 1px solid var(--table-border); line-height: 1.6; }
    #earnings-display div { display: flex; justify-content: space-between; align-items: center; }
    #earnings-amount-gross { color: var(--earnings-color); font-weight: 800; font-size: 16px; }
    #earnings-amount-advance { color: var(--advance-color); font-weight: 800; font-size: 16px; }
    #earnings-amount-net { color: var(--net-earnings-color); font-weight: 800; font-size: 18px; border-top: 1px dashed var(--muted); padding-top: 5px; margin-top: 5px;}

    /* Entry Grid */
    .entry-grid{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .preview{color:var(--muted);font-size:13px}

    /* Tables */
    .table-wrap{overflow:auto;margin-top:14px;border-radius:10px}
    table{width:100%;border-collapse:collapse;min-width:700px}
    thead th{padding:10px 12px;text-align:left;color:var(--muted);font-size:12px;text-transform:uppercase;border-bottom:1px solid var(--table-border)}
    tbody td{padding:10px 12px;border-bottom:1px solid var(--table-border)}
    tbody tr:nth-child(odd){background:rgba(255,255,255,0.01)}
    tr.day-off { background: var(--dayoff-bg) !important; color: var(--dayoff-text) !important; font-weight: 600; border: 1px solid var(--dayoff-border) !important; }
    tr.day-off td { font-style: italic; border-bottom: 1px solid var(--dayoff-border) !important; padding: 10px 12px; }
    tr.day-off td:first-child::before { content: "🚨 "; margin-right: 5px; }
    .actions{display:flex;gap:8px}
    .chip{padding:6px 10px;border-radius:8px;font-weight:600;cursor:pointer}
    .chip.edit{background:var(--success);color:#fff}
    .chip.del{background:var(--danger);color:#fff}

    /* Advance Section */
    .advance-section { margin-top: 16px; }
    .advance-section h3 { margin-top: 0; color: var(--advance-color); }
    .advance-grid { display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-end; margin-bottom: 10px;}
    .advance-grid .input-group { flex: 1; min-width: 120px; }
    .advance-grid .input-group.amount-group { flex: 0 1 150px; }
    .advance-grid .input-group.note-group { flex: 2; }
    .btn.advance-btn { background: var(--advance-color); color: #fff; }
    #advances-table { min-width: 500px; }
    #advances-table td:nth-child(2) { color: var(--advance-color); font-weight: 700; }

    /* Admin Modal */
    #admin-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 2000; padding: 20px; animation: overlayFadeIn 0.3s ease-out; }
    #admin-panel { margin-top: 0; width: 100%; max-width: 500px; background: linear-gradient(180deg, var(--danger), #a13030); border-color: #ff6060; position: relative; animation: panelSlideIn 0.4s ease-out; }
    #admin-panel h2 { margin-top: 0; color: #fff; border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-bottom: 10px; }
    #admin-panel .input-group label { color: #ffcfcf; }
    #admin-panel .input-group input { background: var(--input-bg); }
    #admin-results { margin-top: 15px; background: var(--bg); padding: 10px 15px; border-radius: 8px; display:none; color: var(--text); line-height: 1.7; }
    #admin-results strong { color: var(--text); display: inline-block; min-width: 180px; }
    #admin-results span { font-weight: bold; }
    #admin-results span.gross { color: var(--earnings-color); } #admin-results span.advance { color: var(--advance-color); } #admin-results span.net { color: var(--net-earnings-color); }
    #admin-close-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); color: #fff; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 18px; line-height: 1; cursor: pointer; transition: background 0.2s ease; }
    #admin-close-btn:hover { background: rgba(255,255,255,0.4); }

    /* Mobile & Print Styles */
    @media(max-width:768px){
      .entry-grid, .advance-grid, .controls-top {flex-direction:column; align-items:stretch;}
      .controls-top { gap: 12px; }
      .month-nav-controls { justify-content: space-between; width: 100%; order: 1; }
      .totals-controls { width: 100%; order: 2; flex-direction: column; align-items: stretch;}
      .export-print-controls { width: 100%; order: 3; margin-left: 0; justify-content: center;}
      input[type=date],input[type=time],input[type=text],input[type=number],.btn,.total-card, #earnings-display{width:100%; min-width: unset;}
      .input-group { width: 100%; } table{min-width: 600px} #advances-table { min-width: 400px; }
      header.app-head { padding-top: 50px; } #signedState { position: fixed; top: 0; left: 0; width: 100%; border-radius: 0; border-bottom: 1px solid var(--table-border); box-shadow: 0 1px 5px rgba(0,0,0,0.2); justify-content: flex-end; }
      #admin-panel { max-width: 95%; } .auth-controls { flex-wrap: wrap; justify-content: center;}
      #admin-results strong { min-width: 130px;}
    }
    @media print{ /* ... Print styles ... */ }
  </style>
</head>
<body>
  <div class="wrap">

<div class="auth-area" id="auth-area" style="display:none;">
    <img id="auth-logo" src="YOUR_IMAGE_URL_OR_BASE64" alt="App Logo" />
    <h1 class="auth-area-title" id="auth-title-text">TheVann Tracker</h1>
    <div class="auth-controls">
         <div class="lang-select" id="auth-lang-buttons"> <button data-lang="en">🇺🇸 EN</button> <button data-lang="my">🇲🇲 မြန်မာ</button> <button data-lang="th">🇹🇭 ไทย</button> </div>
         <div class="toggle" id="auth-theme-toggle" title="Toggle theme">🌙</div>
    </div>
    
    <div class="auth-card">
        <form id="signin-form">
            <p class="auth-pane-sub" id="auth-signin-sub">Sign in with your email or Google.</p>
            <div class="input-group"> <label for="login-email">Email</label> <input id="login-email" type="email" placeholder="you@example.com" required/> </div>
            <div class="input-group"> <label for="login-password">Password</label> <input id="login-password" type="password" placeholder="Your password" required/> </div>
            <a class="forgot-password-link" id="forgot-password-link">Forgot Password?</a>
            <button id="login-btn" type="submit" class="auth-btn primary">Sign In</button>
            <div class="auth-divider"> <span>OR</span> </div>
           <button id="googleSignIn" type="button" class="auth-btn google-btn">
    <img src="data:image/webp;base64,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" style="width: 18px; height: 18px; margin-right: 10px;" />
    Continue with Google
</button>
            <a class="auth-switch-link" id="show-register">Need an account? Register</a>
        </form>

        <form id="register-form" style="display: none;">
             <p class="auth-pane-sub" id="auth-register-sub">Create a new account with your email.</p>
             <div class="input-group"> <label for="register-username">Username</label> <input id="register-username" type="text" placeholder="Your unique name" required/> </div>
             <div class="input-group"> <label for="register-email">Email</label> <input id="register-email" type="email" placeholder="you@example.com" required/> </div>
             <div class="input-group"> <label for="register-password">Password</label> <input id="register-password" type="password" placeholder="Min. 6 characters" required/> </div>
             <button id="register-btn" type="submit" class="auth-btn primary">Register Account</button>
             <p class="auth-terms-footer">By signing up, you accept our<br><a href="#">Terms of Use</a> and <a href="#">Privacy Policy</a>.</p>
             <a class="auth-switch-link" id="show-signin">Already have an account? Sign In</a>
        </form>

        <form id="reset-password-form" style="display: none;">
            <p class="auth-pane-sub" id="auth-reset-sub">Reset your password.</p>
            <div class="input-group"> <label for="reset-email">Email</label> <input id="reset-email" type="email" placeholder="Your account email" required/> </div>
            <button id="reset-btn" type="submit" class="auth-btn primary">Send Reset Link</button>
            <a class="auth-switch-link" id="back-to-signin">Back to Sign In</a>
        </form>

        <p id="auth-message" style="color:var(--accent); margin-top: 15px; text-align: center; min-height: 20px;"></p>
    </div>
</div>

    <div id="username-modal" style="display:none;"> <div id="username-form-card" class="card"> <h3 id="modal-title">...</h3> <p id="modal-subtitle">...</p> <input id="username-input-field" type="text"/> <button id="save-username-btn" class="primary btn">...</button> </div> </div>
    <div id="loading-screen" class="card" style="display:none;"> <h2>...</h2> <p>...</p> </div>

    <div class="card" id="app-content" style="display:none;">
      <header class="app-head">
        <div id="signedState"> <div class="signed-as" id="signedText"></div> <button id="signOut" class="auth-btn secondary"></button> </div>
        <div class="title-wrap"> <img id="app-logo" src="YOUR_IMAGE_URL_OR_BASE64" alt="App Logo" /> <div> <h1 class="title" id="app-title">...</h1> <div class="subtitle" id="app-sub">...</div> </div> </div>
        <div class="right-controls"> <div class="lang-select" id="lang-buttons"> <button data-lang="en">🇺🇸 EN</button> <button data-lang="my">🇲🇲 မြန်မာ</button> <button data-lang="th">🇹🇭 ไทย</button> </div> <div style="display:flex;gap:8px;align-items:center"> <div class="toggle" id="theme-toggle">🌙</div> <button id="admin-menu-btn" class="toggle">⚙️</button> </div> </div>
      </header>

      <div class="advance-section"> <h3 id="advance-title">...</h3> <div class="advance-grid"> <div class="input-group"> <label id="advance-date-label" for="advance-date">...</label> <input id="advance-date" type="date" /> </div> <div class="input-group amount-group"> <label id="advance-amount-label" for="advance-amount">...</label> <input id="advance-amount" type="number"/> </div> <div class="input-group note-group"> <label id="advance-note-label" for="advance-note">...</label> <input id="advance-note" type="text"/> </div> <button id="add-advance-btn" class="btn advance-btn">...</button> </div> <div class="table-wrap"> <table id="advances-table"> <thead> <tr> <th id="th-advance-date">...</th> <th id="th-advance-amount">...</th> <th id="th-advance-note">...</th> <th class="actions" id="th-advance-actions">...</th> </tr> </thead> <tbody id="advances-body"></tbody> </table> </div> </div>

      <div class="controls-top">
        <div class="month-nav-controls"> <button id="prev-month" class="ghost btn">◀</button> <div id="month-label">...</div> <button id="next-month" class="ghost btn">▶</button> <button id="today-month" class="ghost btn">🗓️ Today</button> </div>
        <div class="totals-controls"> <div class="total-card" id="total-header"> <span id="total-label">...</span> <span id="total">0.00</span> <button id="toggle-total-hours" class="visibility-toggle">👁️</button> </div> <div class="earnings-wrapper"> <div id="earnings-display"></div> </div> </div>
        <div class="export-print-controls"> <button id="export-csv" class="ghost btn">...</button> <button id="print-btn" class="ghost btn">...</button> </div>
      </div>

      <div class="entry-grid"> <div class="input-group"> <label id="date-label" for="date-input">...</label> <input id="date-input" type="date" /> </div> <div class="input-group"> <label id="start-label" for="start-input">...</label> <input id="start-input" type="time" /> </div> <div class="input-group"> <label id="end-label" for="end-input">...</label> <input id="end-input" type="time" /> </div> <div class="input-group" style="flex-grow: 1;"> <label id="task-label" for="task-input">...</label> <input id="task-input" type="text"/> </div> <div class="preview" id="preview">...</div> <div> <button id="add-btn" class="primary btn">...</button> <button id="dayoff-btn" class="ghost btn">...</button> </div> </div>
      <div class="table-wrap"> <table id="entries-table"> <thead> <tr> <th id="th-date">...</th> <th id="th-start">...</th> <th id="th-end">...</th> <th id="th-duration">...</th> <th id="th-rounded">...</th> <th id="th-task">...</th> <th class="actions" id="th-actions">...</th> </tr> </thead> <tbody id="entries-body"></tbody> </table> </div>
      <div class="footer" style="display:none;"> <div class="total-card">Total Rounded Hours: <span id="total-footer">0.00</span></div> </div>
    </div>
    <div id="admin-modal-overlay"> <div id="admin-panel" class="card"> <button id="admin-close-btn">&times;</button> <h2>Admin Panel</h2> <div class="input-group"> <label for="admin-search-uid">Search User by UID</label> <input id="admin-search-uid" type="text"/> </div> <button id="admin-search-btn" class="primary btn" style="background:#fff; color:#b91c1c; border:none;">Search</button> <div id="admin-results" style="display:none;"></div> </div> </div>
  </div> <script type="module">
  // --- Firebase imports (Add sendPasswordResetEmail) ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, updateProfile, createUserWithEmailAndPassword, sendEmailVerification, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

  // --- Firebase config & Init ---
  const firebaseConfig = { apiKey: "AIzaSyBPt8cZMMW6gs8TLV-7EEvpJJVZ33DH23k", authDomain: "thevanntrackduration-81ee0.firebaseapp.com", projectId: "thevanntrackduration-81ee0", storageBucket: "thevanntrackduration-81ee0.firebasestorage.app", messagingSenderId: "56786707859", appId: "1:56786707859:web:75be757ceb95604984f466", measurementId: "G-QNG2F09LWL" };
  const app = initializeApp(firebaseConfig); const auth = getAuth(app); const provider = new GoogleAuthProvider(); const db = getFirestore(app);

  // --- CONSTANTS ---
  const HOURLY_RATE = 40.00; const ADMIN_UID = 'h1OJyFLAFDRWgwiZxf2G1rbIapl1';
  // --- DOM Elements ---
  const authArea = document.getElementById('auth-area'), authCard = authArea.querySelector('.auth-card'), authLogo = document.getElementById('auth-logo'), authTitleText = document.getElementById('auth-title-text'), authControls = authCard.querySelector('.auth-controls'), authLangButtons = document.getElementById('auth-lang-buttons'), authThemeToggle = document.getElementById('auth-theme-toggle'), tabSigninBtn = document.getElementById('tab-signin'), tabRegisterBtn = document.getElementById('tab-register'), signinPane = document.getElementById('signin-pane'), authSigninSub = document.getElementById('auth-signin-sub'), loginEmailEl = document.getElementById('login-email'), loginPasswordEl = document.getElementById('login-password'), loginBtn = document.getElementById('login-btn'), googleSignInBtn = document.getElementById('googleSignIn'), registerPane = document.getElementById('register-pane'), authRegisterSub = document.getElementById('auth-register-sub'), registerUsernameEl = document.getElementById('register-username'), registerEmailEl = document.getElementById('register-email'), registerPasswordEl = document.getElementById('register-password'), registerBtn = document.getElementById('register-btn'), authMessageEl = document.getElementById('auth-message');
  const usernameModal = document.getElementById('username-modal'), usernameInputField = document.getElementById('username-input-field'), saveUsernameBtn = document.getElementById('save-username-btn');
  const loadingScreen = document.getElementById('loading-screen');
  const appContent = document.getElementById('app-content'), signedState = document.getElementById('signedState'), signedText = document.getElementById('signedText'), signOutBtn = document.getElementById('signOut'), appLogo = document.getElementById('app-logo'), langButtons = document.getElementById('lang-buttons'), themeToggle = document.getElementById('theme-toggle'), adminMenuBtn = document.getElementById('admin-menu-btn');
  const advanceSection = appContent.querySelector('.advance-section'), advanceDateEl = document.getElementById('advance-date'), advanceAmountEl = document.getElementById('advance-amount'), advanceNoteEl = document.getElementById('advance-note'), addAdvanceBtn = document.getElementById('add-advance-btn'), advancesBody = document.getElementById('advances-body'), advanceTitle = document.getElementById('advance-title'), advanceDateLabel = document.getElementById('advance-date-label'), advanceAmountLabel = document.getElementById('advance-amount-label'), advanceNoteLabel = document.getElementById('advance-note-label');
  const controlsTop = appContent.querySelector('.controls-top'), prevMonthBtn = document.getElementById('prev-month'), monthLabel = document.getElementById('month-label'), nextMonthBtn = document.getElementById('next-month'), todayMonthBtn = document.getElementById('today-month'), totalHeaderEl = document.getElementById('total-header'), totalLabelSpan = document.getElementById('total-label'), totalEl = totalHeaderEl.querySelector('#total'), toggleTotalHoursBtn = document.getElementById('toggle-total-hours'), earningsDisplay = document.getElementById('earnings-display'), exportBtn = document.getElementById('export-csv'), printBtn = document.getElementById('print-btn');
  const entryGrid = appContent.querySelector('.entry-grid'), dateEl = document.getElementById('date-input'), startEl = document.getElementById('start-input'), endEl = document.getElementById('end-input'), taskEl = document.getElementById('task-input'), previewEl = document.getElementById('preview'), addBtn = document.getElementById('add-btn'), dayOffBtn = document.getElementById('dayoff-btn');
  const entriesBody = document.getElementById('entries-body');
  const dateLabel = document.getElementById('date-label'), startLabel = document.getElementById('start-label'), endLabel = document.getElementById('end-label'), taskLabel = document.getElementById('task-label');
  const thDate = document.getElementById('th-date'), thStart = document.getElementById('th-start'), thEnd = document.getElementById('th-end'), thDuration = document.getElementById('th-duration'), thRounded = document.getElementById('th-rounded'), thTask = document.getElementById('th-task'), thActions = document.getElementById('th-actions'), thAdvanceDate = document.getElementById('th-advance-date'), thAdvanceAmount = document.getElementById('th-advance-amount'), thAdvanceNote = document.getElementById('th-advance-note'), thAdvanceActions = document.getElementById('th-advance-actions');
  const adminModalOverlay = document.getElementById('admin-modal-overlay'), adminPanel = document.getElementById('admin-panel'), adminCloseBtn = document.getElementById('admin-close-btn'), adminSearchBtn = document.getElementById('admin-search-btn'), adminSearchInput = document.getElementById('admin-search-uid'), adminResultsEl = document.getElementById('admin-results');
  const signinForm = document.getElementById('signin-form'), registerForm = document.getElementById('register-form'), resetPasswordForm = document.getElementById('reset-password-form');
  const showRegisterLink = document.getElementById('show-register'), showSigninLink = document.getElementById('show-signin'), forgotPasswordLink = document.getElementById('forgot-password-link'), backToSigninLink = document.getElementById('back-to-signin');
  const resetEmailEl = document.getElementById('reset-email'), resetBtn = document.getElementById('reset-btn'), authResetSub = document.getElementById('auth-reset-sub');

  // --- Keys for Local Storage ---
  const STORAGE_ENTRIES = 'vann_v8_entries', STORAGE_ADVANCES = 'vann_v8_advances', THEME = 'vann_v8_theme', LANG = 'vann_v8_lang', MONTH = 'vann_v8_month', EARNINGS_HIDDEN = 'vann_v8_earnings_hidden', TOTAL_HOURS_HIDDEN = 'vann_v8_total_hours_hidden';
  // --- Translations ---
  const translations = {
    en: { app_title:'TheVann Track Duration', sub:'Auto rounding, monthly view', add_entry:'Add Entry', add_dayoff:'Day Off', export_csv:'Export CSV', print:'Print', duration_default:'Duration: 00:00 (0.00h)', total_label:'Total Rounded Hours', alert_fill:'Please fill Date, Start and End.', edit: '✏️ Edit', del: '🗑️ Delete', day_off_text: 'Day Off', date_label: 'Date', in_label: 'IN', out_label: 'OUT', task_placeholder: 'Task / notes (optional)', csv_user_label: 'User Name', modal_title: 'Set Your Display Name', modal_subtitle: 'This name will be used in reports.', save_name: 'Save Name', sign_out_btn: 'Sign out', currency: '฿', th_date: 'Date', th_start: 'Start', th_end: 'End', th_duration: 'Duration', th_rounded: 'Rounded (hrs)', th_task: 'Task', th_actions: 'Actions', advance_title: 'Salary Advances', advance_date_label: 'Date', advance_amount_label: 'Amount', advance_note_label: 'Note (optional)', advance_note_placeholder: 'Reason for advance...', add_advance: 'Add Advance', th_advance_date: 'Date', th_advance_amount: 'Amount', th_advance_note: 'Note', th_advance_actions: 'Actions', alert_advance_fill: 'Please fill Date and Amount for advance.', alert_advance_amount: 'Advance amount must be a positive number.', gross_earnings: 'Gross Earnings', total_advance: 'Total Advance', net_earnings: 'Net Earnings', auth_title: 'TheVann Tracker', auth_signin_sub: 'Sign in with your email or Google.', auth_register_sub: 'Create a new account with your email.', forgot_password_link: 'Forgot Password?', auth_reset_sub: 'Reset your password.', send_reset_link: 'Send Reset Link', back_to_signin: 'Back to Sign In', reset_email_sent: 'Password reset email sent!', reset_fill_email: 'Please enter your email address.', auth_need_account: 'Need an account? Register', auth_have_account: 'Already have an account? Sign In' },
    my: { app_title:'Thevann အချိန်မှတ်တမ်း', sub:'လစဉ် ကြည့်ရှုမှု၊ ဘာသာစကားများ', add_entry:'မှတ်တမ်းထည့်မည်', add_dayoff:'နားရက်', export_csv:'CSV ထုတ်ယူမည်', print:'ပုံနှိပ်', duration_default:'ကြာချိန်: 00:00 (0.00နာရီ)', total_label:'စုစုပေါင်း ပတ်လည်နာရီ', alert_fill:'ရက်စွဲ၊ စတင်နှင့် အဆုံးချိန်ထည့်ပါ။', edit: '✏️ ပြင်ဆင်', del: '🗑️ ဖျက်မည်', day_off_text: 'နားရက်', date_label: 'ရက်စွဲ', in_label: 'ဝင်ချိန်', out_label: 'ထွက်ချိန်', task_placeholder: 'မှတ်စု (ထည့်ရန်မလိုပါ)', csv_user_label: 'အသုံးပြုသူအမည်', modal_title: 'မိမိအမည် သတ်မှတ်ပါ', modal_subtitle: 'ဤအမည်ကို အစီရင်ခံစာများတွင် အသုံးပြုမည်။', save_name: 'အမည်သိမ်းမည်', sign_out_btn: 'ထွက်မည်', currency: '฿', th_date: 'ရက်စွဲ', th_start: 'ဝင်ချိန်', th_end: 'ထွက်ချိန်', th_duration: 'ကြာချိန်', th_rounded: 'နာရီ', th_task: 'အလုပ်', th_actions: 'လုပ်ဆောင်ချက်', advance_title: 'ကြိုတင်ထုတ်ငွေများ', advance_date_label: 'ရက်စွဲ', advance_amount_label: 'ပမာဏ', advance_note_label: 'မှတ်စု (ထည့်ရန်မလိုပါ)', advance_note_placeholder: 'ထုတ်ယူသည့်အကြောင်းရင်း...', add_advance: 'ကြိုတင်ငွေထည့်မည်', th_advance_date: 'ရက်စွဲ', th_advance_amount: 'ပမာဏ', th_advance_note: 'မှတ်စု', th_advance_actions: 'လုပ်ဆောင်ချက်', alert_advance_fill: 'ရက်စွဲ နှင့် ကြိုတင်ထုတ် ပမာဏ ထည့်ပါ။', alert_advance_amount: 'ကြိုတင်ထုတ် ပမာဏသည် အပေါင်းကိန်း ဖြစ်ရပါမည်။', gross_earnings: 'စုစုပေါင်းဝင်ငွေ', total_advance: 'စုစုပေါင်း ကြိုထုတ်ငွေ', net_earnings: 'လက်ကျန်ရငွေ', auth_title: 'Thevann အချိန်မှတ်', auth_signin_sub: 'Email (သို့) Google ဖြင့် ဝင်ရောက်ပါ။', auth_register_sub: 'Email ဖြင့် အကောင့်သစ် ပြုလုပ်ပါ။', forgot_password_link: 'စကားဝှက်မေ့နေသလား?', auth_reset_sub: 'စကားဝှက်ကို ပြန်လည်သတ်မှတ်ပါ။', send_reset_link: 'Reset Link ပို့မည်', back_to_signin: 'Sign In သို့ ပြန်သွားမည်', reset_email_sent: 'စကားဝှက်ပြန်လည်သတ်မှတ်ရန် email ပို့လိုက်ပါပြီ!', reset_fill_email: 'သင်၏ email လိပ်စာကို ထည့်ပါ။', auth_need_account: 'အကောင့်မရှိသေးဘူးလား? မှတ်ပုံတင်ပါ', auth_have_account: 'အကောင့်ရှိပြီးသားလား? Sign In ဝင်ပါ' },
    th: { app_title:'ตัวจับเวลาทำงานของแวน', sub:'ดูตามเดือน รองรับหลายภาษา', add_entry:'เพิ่มรายการ', add_dayoff:'วันหยุด', export_csv:'ส่งออก CSV', print:'พิมพ์', duration_default:'ระยะเวลา: 00:00 (0.00 ชม.)', total_label:'รวมระยะเวลาปัดเศษ', alert_fill:'กรุณากรอกวันที่ เวลาเริ่ม และ เวลาออก', edit: '✏️ แก้ไข', del: '🗑️ ลบ', day_off_text: 'วันหยุด', date_label: 'วันที่', in_label: 'เข้า', out_label: 'ออก', task_placeholder: 'งาน / หมายเหตุ (ไม่บังคับ)', csv_user_label: 'ชื่อผู้ใช้', modal_title: 'กำหนดชื่อแสดงผล', modal_subtitle: 'ชื่อนี้จะถูกใช้ในรายงาน', save_name: 'บันทึกชื่อ', sign_out_btn: 'ออกจากระบบ', currency: '฿', th_date: 'วันที่', th_start: 'เริ่ม', th_end: 'สิ้นสุด', th_duration: 'ระยะเวลา', th_rounded: 'ชม. (ปัดเศษ)', th_task: 'งาน', th_actions: 'การกระทำ', advance_title: 'เบิกล่วงหน้า', advance_date_label: 'วันที่', advance_amount_label: 'จำนวนเงิน', advance_note_label: 'หมายเหตุ (ไม่บังคับ)', advance_note_placeholder: 'เหตุผลในการเบิก...', add_advance: 'เพิ่มรายการเบิก', th_advance_date: 'วันที่', th_advance_amount: 'จำนวนเงิน', th_advance_note: 'หมายเหตุ', th_advance_actions: 'การกระทำ', alert_advance_fill: 'กรุณากรอก วันที่ และ จำนวนเงิน ที่เบิก', alert_advance_amount: 'จำนวนเงินที่เบิกต้องเป็นค่าบวก', gross_earnings: 'รายได้รวม', total_advance: 'ยอดเบิกล่วงหน้า', net_earnings: 'รายรับสุทธิ', auth_title: 'TheVann Tracker', auth_signin_sub: 'เข้าสู่ระบบด้วยอีเมลหรือ Google', auth_register_sub: 'สร้างบัญชีใหม่ด้วยอีเมลของคุณ', forgot_password_link: 'ลืมรหัสผ่าน?', auth_reset_sub: 'รีเซ็ตรหัสผ่านของคุณ', send_reset_link: 'ส่งลิงก์รีเซ็ต', back_to_signin: 'กลับไปที่หน้าลงชื่อเข้าใช้', reset_email_sent: 'ส่งอีเมลรีเซ็ตรหัสผ่านแล้ว!', reset_fill_email: 'กรุณากรอกที่อยู่อีเมลของคุณ', auth_need_account: 'ยังไม่มีบัญชี? ลงทะเบียน', auth_have_account: 'มีบัญชีอยู่แล้ว? ลงชื่อเข้าใช้' }
  };
  // --- Application State ---
  let entries = [], advances = [], editId = null, selectedYear, selectedMonth;
  let currentLang = localStorage.getItem(LANG) || 'en', currentUser = null;
  let isEarningsHidden = false, isTotalHoursHidden = false;

  // --- Helper Functions ---
  function parseHM(t){ if(!t) return null; const [h,m]=t.split(':').map(Number); if(Number.isNaN(h)||Number.isNaN(m)) return null; return h*60+m; }
  function fmtHM(min){ const h=Math.floor(min/60); const m=min%60; return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}` }
  function computeRounded(raw){ if(raw<=0) return 0.00; const h=Math.floor(raw/60); const m=raw%60; let H=h; if(m>=0 && m<=29) { return +(H).toFixed(2); } else if(m>=30 && m<=39) { return +(H + 0.5).toFixed(2); } else if(m>=40 && m<=59){ return +(H + 1).toFixed(2); } return +(H).toFixed(2); }
  async function isUsernameTaken(username) { const uRef = doc(db, 'usernames', username.toLowerCase()); const docSnap = await getDoc(uRef); return docSnap.exists(); }

  // --- Update Earnings Display ---
  function updateEarningsDisplay() { const t = translations[currentLang], currency = t.currency || '฿'; const totalHoursValue = parseFloat(localStorage.getItem('temp_total_hours_for_calc') || '0'); const grossEarnings = (totalHoursValue * HOURLY_RATE); let totalAdvance = 0; advances.filter(a => { const d = new Date(a.date); return d.getFullYear() === selectedYear && d.getMonth() === selectedMonth; }).forEach(a => totalAdvance += a.amount); const netEarnings = grossEarnings - totalAdvance; const hiddenValue = `******** ${currency}`; earningsDisplay.innerHTML = `<div><span>${t.gross_earnings}:</span><span id="earnings-amount-gross">${isEarningsHidden ? hiddenValue : grossEarnings.toFixed(2) + ' ' + currency}</span><button id="toggle-earnings-visibility" class="visibility-toggle earnings-toggle">${isEarningsHidden ? '🙈' : '👁️'}</button></div><div><span>${t.total_advance}:</span><span id="earnings-amount-advance" style="color:var(--advance-color);">${isEarningsHidden ? hiddenValue : totalAdvance.toFixed(2) + ' ' + currency}</span></div><div><span style="font-weight:800;">${t.net_earnings}:</span><span id="earnings-amount-net" style="color:var(--net-earnings-color);">${isEarningsHidden ? hiddenValue : netEarnings.toFixed(2) + ' ' + currency}</span></div>`; const toggleBtn = document.getElementById('toggle-earnings-visibility'); if (toggleBtn) { toggleBtn.addEventListener('click', toggleEarningsVisibility); } }
  function toggleEarningsVisibility() { isEarningsHidden = !isEarningsHidden; localStorage.setItem(EARNINGS_HIDDEN, isEarningsHidden); updateEarningsDisplay(); }
  // --- Update Total Hours Visibility ---
  function updateTotalHoursVisibility() { const t = translations[currentLang]; const totalHoursValue = parseFloat(localStorage.getItem('temp_total_hours_for_calc') || '0'); if (isTotalHoursHidden) { totalEl.textContent = '********'; toggleTotalHoursBtn.textContent = '🙈'; } else { totalEl.textContent = totalHoursValue.toFixed(2); toggleTotalHoursBtn.textContent = '👁️'; } totalLabelSpan.textContent = t.total_label + ':'; }
  // --- Local Storage & Firestore ---
  function saveLocal(){ localStorage.setItem(STORAGE_ENTRIES, JSON.stringify(entries)); localStorage.setItem(STORAGE_ADVANCES, JSON.stringify(advances)); render(); }
  function loadLocal(){ const re = localStorage.getItem(STORAGE_ENTRIES); entries = re ? JSON.parse(re) : []; const ra = localStorage.getItem(STORAGE_ADVANCES); advances = ra ? JSON.parse(ra) : [];}
  async function saveToFirestore(uid){ if(!uid) return; try{ const dRef = doc(db, 'users', uid); await setDoc(dRef, { entries, advances }, { merge: true }); }catch(err){ console.error('saveToFirestore error:', err); }}
  async function loadFromFirestore(uid){ if(!uid) return null; try{ const dRef = doc(db, 'users', uid); const snap = await getDoc(dRef); if(snap.exists()){ const data = snap.data(); return { entries: (Array.isArray(data.entries) ? data.entries : []), advances: (Array.isArray(data.advances) ? data.advances : []) }; } else { return { entries: [], advances: [] }; } }catch(err){ console.error('loadFromFirestore error:', err); return null; }}
  // --- Username Setup ---
  async function handleUsernameSetup(user) { usernameModal.style.display = 'flex'; usernameInputField.value = user.displayName || (user.email ? user.email.split('@')[0] : 'Your Name'); const t = translations[currentLang]; document.getElementById('modal-title').textContent = t.modal_title; document.getElementById('modal-subtitle').textContent = t.modal_subtitle; document.getElementById('save-username-btn').textContent = t.save_name; }
  saveUsernameBtn.addEventListener('click', async () => { const newName = usernameInputField.value.trim(); if (!newName) { alert('Please enter a name.'); return; } if (currentUser) { try { await updateProfile(currentUser, { displayName: newName }); currentUser.displayName = newName; usernameModal.style.display = 'none'; handleUserSignedIn(currentUser); } catch (error) { console.error('Error updating profile:', error); alert('Failed to save name: ' + error.message); } } });
  // --- UI State Control ---
  function showLoadingState(){ authArea.style.display = 'none'; appContent.style.display = 'none'; signedState.style.display = 'none'; usernameModal.style.display = 'none'; loadingScreen.style.display = 'block'; loadingScreen.querySelector('h2').innerHTML = '⏳ Loading...'; loadingScreen.querySelector('p').textContent = 'Checking authentication status...'; }
  // --- Handle User Signed In ---
  async function handleUserSignedIn(user){
    currentUser = user; const uid = user.uid;
    if (!user.emailVerified && !user.providerData.some(p => p.providerId === 'google.com')) { showLoadingState(); loadingScreen.querySelector('h2').innerHTML = 'Email Verification Required'; loadingScreen.querySelector('p').textContent = `Verification link sent to ${user.email}. Please verify.`; authArea.style.display = 'none'; appContent.style.display = 'none'; signedState.style.display = 'none'; try { await signOut(auth); } catch(e) { console.error("Sign out error", e); } return; }
    if (!user.displayName || user.displayName === '' || user.displayName.includes('@')) { await handleUsernameSetup(user); return; }
    signedText.textContent = `Signed in: ${user.displayName}`; signedState.style.display = 'flex'; authArea.style.display = 'none'; appContent.style.display = 'block'; loadingScreen.style.display = 'none';
    adminMenuBtn.style.display = (user.uid === ADMIN_UID) ? 'inline-block' : 'none';
    const cloudData = await loadFromFirestore(uid); if(cloudData === null){ console.warn('Firestore error, using local'); loadLocal(); } else { entries = cloudData.entries; advances = cloudData.advances; if (cloudData.entries.length === 0 && cloudData.advances.length === 0) { const le = localStorage.getItem(STORAGE_ENTRIES), la = localStorage.getItem(STORAGE_ADVANCES); const localEntries = le ? JSON.parse(le) : [], localAdvances = la ? JSON.parse(la) : []; if (localEntries.length > 0 || localAdvances.length > 0) { entries = localEntries; advances = localAdvances; await saveToFirestore(uid); } } saveLocal(); }
  }
  // --- Handle User Signed Out ---
  function handleUserSignedOut(){ currentUser = null; signedState.style.display = 'none'; usernameModal.style.display = 'none'; authArea.style.display = 'flex'; appContent.style.display = 'none'; loadingScreen.style.display = 'none'; adminMenuBtn.style.display = 'none'; adminModalOverlay.style.display = 'none'; adminResultsEl.style.display = 'none'; adminSearchInput.value = ''; localStorage.removeItem(STORAGE_ENTRIES); localStorage.removeItem(STORAGE_ADVANCES); localStorage.removeItem('temp_total_hours_for_calc'); loadLocal(); showForm(signinForm); /* Reset to signin form */ applyAuthLanguageTexts(); render(); }
  // --- Auth State Listener ---
  onAuthStateChanged(auth, async (user) => { if(user){ await handleUserSignedIn(user); } else { handleUserSignedOut(); }});
  // --- Sign In/Out Buttons ---
  googleSignInBtn.addEventListener('click', async ()=>{ showLoadingState(); try{ await signInWithPopup(auth, provider); } catch(err){ alert('Google sign-in failed: ' + err.message); handleUserSignedOut(); }});
  signOutBtn.addEventListener('click', async ()=>{ try{ await signOut(auth); } catch(err){ console.error(err); }});
  // --- Update duration preview ---
  function updatePreview(){ const s=startEl.value, e=endEl.value; if(s && e){ const sM=parseHM(s), eM=parseHM(e); if(sM==null||eM==null){ previewEl.textContent = translations[currentLang].duration_default; return; } let diff=eM - sM; if(diff<0) diff+=24*60; previewEl.textContent = `Duration: ${fmtHM(diff)} (${computeRounded(diff).toFixed(2)}h)` } else { previewEl.textContent = translations[currentLang].duration_default } }
  [startEl,endEl].forEach(i=>i.addEventListener('input', updatePreview));
  // --- Render the main UI ---
  function render(){
    if (!currentUser) { authArea.style.display = 'flex'; appContent.style.display = 'none'; return; }
    entriesBody.innerHTML = ''; let totalHours = 0;
    const filteredEntries = entries.filter(r=>{ const d = new Date(r.date); return d.getFullYear()===selectedYear && d.getMonth()===selectedMonth; });
    filteredEntries.sort((a,b)=> a.date < b.date ? 1 : a.date > b.date ? -1 : b.id - a.id);
    const t = translations[currentLang]; const dayOffText = t.day_off_text || 'Day Off';
    for(const row of filteredEntries){ const tr = document.createElement('tr'); if(row.isDayOff) tr.classList.add('day-off'); const start = row.isDayOff? dayOffText : row.start; const end = row.isDayOff? dayOffText : row.end; const duration = row.isDayOff? dayOffText : row.duration; const rounded = row.isDayOff? 0 : row.rounded; const taskDisplay = row.isDayOff ? dayOffText : row.task || ''; tr.innerHTML = `<td>${row.date}</td><td>${start}</td><td>${end}</td><td>${duration}</td><td>${rounded.toFixed(2)}</td><td class="${row.isDayOff? 'day-off-task':''}">${taskDisplay}</td><td class="actions">${row.isDayOff? `<button class="chip del" data-type="entry" data-id="${row.id}">${t.del}</button>` : `<button class="chip edit" data-id="${row.id}">${t.edit}</button><button class="chip del" data-type="entry" data-id="${row.id}">${t.del}</button>`}</td>`; entriesBody.appendChild(tr); totalHours += rounded; }
    localStorage.setItem('temp_total_hours_for_calc', totalHours.toFixed(2));
    advancesBody.innerHTML = '';
    const filteredAdvances = advances.filter(a => { const d = new Date(a.date); return d.getFullYear() === selectedYear && d.getMonth() === selectedMonth; });
    filteredAdvances.sort((a, b) => a.date < b.date ? 1 : a.date > b.date ? -1 : b.id - a.id);
    for (const row of filteredAdvances) { const tr = document.createElement('tr'); tr.innerHTML = `<td>${row.date}</td><td>${row.amount.toFixed(2)} ${t.currency}</td><td>${row.note || ''}</td><td class="actions"><button class="chip del" data-type="advance" data-id="${row.id}">${t.del}</button></td>`; advancesBody.appendChild(tr); }
    const localeCode = { en: 'en-US', my: 'my-MM', th: 'th-TH' }[currentLang]; monthLabel.textContent = new Date(selectedYear, selectedMonth, 1).toLocaleString(localeCode, { month: 'long', year: 'numeric' });
    applyLanguageTexts();
  }
  // --- Save All Data ---
  async function saveAll(){ localStorage.setItem(STORAGE_ENTRIES, JSON.stringify(entries)); localStorage.setItem(STORAGE_ADVANCES, JSON.stringify(advances)); render(); if(currentUser){ await saveToFirestore(currentUser.uid); }}
  // --- Add/Update Entry ---
  addBtn.addEventListener('click', async ()=>{ const date = dateEl.value; const s = startEl.value; const e = endEl.value; const task = taskEl.value.trim(); if(!date || !s || !e) return alert(translations[currentLang].alert_fill); const sM = parseHM(s), eM = parseHM(e); if(sM==null||eM==null) return alert('Invalid time'); let diff = eM - sM; if(diff<0) diff += 24*60; const formatted = fmtHM(diff); const rounded = computeRounded(diff); if(editId){ const idx = entries.findIndex(x=>x.id===editId); if(idx>-1){ entries[idx] = { id: editId, date, start: s, end: e, duration: formatted, rounded, task, isDayOff:false }; editId = null; addBtn.textContent = '➕ ' + translations[currentLang].add_entry; } } else { entries.push({ id: Date.now(), date, start: s, end: e, duration: formatted, rounded, task, isDayOff:false }); } formReset(); await saveAll(); });
  // --- Reset Entry Form ---
  function formReset(){ dateEl.valueAsDate = new Date(selectedYear, selectedMonth, Math.min(new Date().getDate(),28)); startEl.value=''; endEl.value=''; taskEl.value=''; taskEl.placeholder = translations[currentLang].task_placeholder; previewEl.textContent = translations[currentLang].duration_default; addBtn.textContent = '➕ ' + translations[currentLang].add_entry; editId = null; }
  // --- Add Day Off ---
  dayOffBtn.addEventListener('click', async ()=>{ const date = dateEl.value; if(!date) return alert(translations[currentLang].alert_fill); const dayOffText = translations[currentLang].day_off_text || 'Day Off'; const existingDayOff = entries.some(x => x.date === date && x.isDayOff); if (existingDayOff) { entries = entries.filter(x => !(x.date === date && x.isDayOff)); entries = entries.filter(x => x.date !== date); } else { const regularEntries = entries.filter(x => x.date === date && !x.isDayOff); if (regularEntries.length > 0 && !confirm(`There are ${regularEntries.length} entries on ${date}. Delete them and mark as Day Off?`)) return; entries = entries.filter(x => x.date !== date); entries.push({ id: Date.now(), date, start:'', end:'', duration:'00:00', rounded:0, task: dayOffText, isDayOff:true }); } formReset(); await saveAll(); });
  // --- Unified Edit/Delete Listener ---
  appContent.addEventListener('click', async (ev) => { if (ev.target.classList.contains('edit')) { const idStr = ev.target.getAttribute('data-id'); if (!idStr) return; const id = Number(idStr); const idx = entries.findIndex(x => x.id === id); if (idx === -1) return; const r = entries[idx]; if (r.isDayOff) return alert('Cannot edit Day Off'); dateEl.value = r.date; startEl.value = r.start; endEl.value = r.end; taskEl.value = r.task; editId = id; addBtn.textContent = '💾 Save'; updatePreview(); window.scrollTo({ top: 0, behavior: 'smooth' }); } if (ev.target.classList.contains('del')) { const idStr = ev.target.getAttribute('data-id'); const type = ev.target.getAttribute('data-type'); if (!idStr || !type || !confirm('Delete this item?')) return; const id = Number(idStr); if (type === 'entry') { entries = entries.filter(x => x.id !== id); } else if (type === 'advance') { advances = advances.filter(x => x.id !== id); } await saveAll(); } });
  // --- Export CSV ---
  exportBtn.addEventListener('click', ()=>{ const filteredEntries = entries.filter(r=>{ const d=new Date(r.date); return d.getFullYear()===selectedYear && d.getMonth()===selectedMonth; }); const filteredAdvances = advances.filter(a=>{ const d=new Date(a.date); return d.getFullYear()===selectedYear && d.getMonth()===selectedMonth; }); if(filteredEntries.length===0 && filteredAdvances.length===0) return alert('No data to export for this month'); const t = translations['en']; const currentT = translations[currentLang]; const userName = currentUser ? currentUser.displayName || 'Unknown User' : 'Guest'; const userLabel = currentT.csv_user_label || 'User Name'; const totalHoursValue = parseFloat(localStorage.getItem('temp_total_hours_for_calc') || '0'); const grossEarnings = (totalHoursValue * HOURLY_RATE); let totalAdvance = 0; filteredAdvances.forEach(a => totalAdvance += a.amount); const netEarnings = grossEarnings - totalAdvance; const currency = currentT.currency || '฿'; const entryHeader=['Date','Start','End','Duration','Rounded Hours','Task']; let csv = `${userLabel}:,${userName}\n`; csv += `Month:,${monthLabel.textContent}\n\n`; csv += `Entries:\n`; csv += entryHeader.join(',') + '\n'; filteredEntries.forEach(r=> csv += [r.date, r.isDayOff? t.day_off_text : r.start, r.isDayOff? t.day_off_text : r.end, r.isDayOff? t.day_off_text : r.duration, r.isDayOff? '0.00': r.rounded.toFixed(2), `"${(r.task||'').replace(/"/g,'""')}"`].join(',') + '\n'); csv += `\n`; csv += `${currentT.advance_title}:\n`; csv += `${currentT.th_advance_date},${currentT.th_advance_amount},${currentT.th_advance_note}\n`; filteredAdvances.forEach(a => csv += [a.date, a.amount.toFixed(2), `"${(a.note||'').replace(/"/g,'""')}"`].join(',') + '\n'); csv += `\n`; csv += `Summary:\n`; csv += `${currentT.total_label},${totalHoursValue.toFixed(2)}\n`; csv += `${currentT.gross_earnings},${grossEarnings.toFixed(2)} ${currency}\n`; csv += `${currentT.total_advance},${totalAdvance.toFixed(2)} ${currency}\n`; csv += `${currentT.net_earnings},${netEarnings.toFixed(2)} ${currency}\n`; const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `VannTrack_${userName.replace(/\s/g, '_')}_${selectedYear}-${String(selectedMonth+1).padStart(2,'0')}.csv`; document.body.appendChild(a); a.click(); a.remove(); });
  // --- Print Button ---
  printBtn.addEventListener('click', ()=> window.print());
  // --- Month Navigation ---
  prevMonthBtn.addEventListener('click', ()=>{ selectedMonth--; if(selectedMonth<0){ selectedMonth=11; selectedYear--; } localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });
  nextMonthBtn.addEventListener('click', ()=>{ selectedMonth++; if(selectedMonth>11){ selectedMonth=0; selectedYear++; } localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });
  todayMonthBtn.addEventListener('click', ()=>{ const now=new Date(); selectedYear=now.getFullYear(); selectedMonth=now.getMonth(); localStorage.setItem(MONTH, JSON.stringify({y:selectedYear,m:selectedMonth})); render(); });
  // --- Theme Toggle (Both Pages) ---
  function applyTheme(){ const newTheme = localStorage.getItem(THEME) || 'dark'; if(newTheme==='light'){ document.body.classList.add('light-mode'); themeToggle.textContent='☀️'; authThemeToggle.textContent='☀️'; } else { document.body.classList.remove('light-mode'); themeToggle.textContent='🌙'; authThemeToggle.textContent='🌙'; } }
  themeToggle.addEventListener('click', ()=>{ const current = document.body.classList.contains('light-mode'); localStorage.setItem(THEME, current ? 'dark' : 'light'); applyTheme(); });
  authThemeToggle.addEventListener('click', ()=>{ const current = document.body.classList.contains('light-mode'); localStorage.setItem(THEME, current ? 'dark' : 'light'); applyTheme(); });
  // --- Apply Language Texts (Main App) ---
  function applyLanguageTexts(){
    const t = translations[currentLang]; const currency = t.currency || '฿';
    document.getElementById('app-title').textContent = t.app_title; document.getElementById('app-sub').textContent = t.sub;
    document.getElementById('modal-title').textContent = t.modal_title; document.getElementById('modal-subtitle').textContent = t.modal_subtitle; document.getElementById('save-username-btn').textContent = t.save_name;
    signOutBtn.textContent = t.sign_out_btn;
    dateLabel.textContent = t.date_label; startLabel.textContent = t.in_label; endLabel.textContent = t.out_label; taskLabel.textContent = t.task_placeholder; taskEl.placeholder = t.task_placeholder;
    if (currentUser && currentUser.displayName) { signedText.textContent = `Signed in: ${currentUser.displayName}`; }
    addBtn.textContent = editId ? '💾 Save' : '➕ ' + t.add_entry; dayOffBtn.textContent = '🏖️ ' + t.add_dayoff;
    exportBtn.textContent = '💾 ' + t.export_csv; printBtn.textContent = '🖨️ ' + t.print;
    if (!startEl.value || !endEl.value) { previewEl.textContent = t.duration_default; }
    const localeCode = { en: 'en-US', my: 'my-MM', th: 'th-TH' }[currentLang] || 'en-US'; monthLabel.textContent = new Date(selectedYear, selectedMonth, 1).toLocaleString(localeCode, { month: 'long', year: 'numeric' });
    advanceTitle.textContent = t.advance_title; advanceDateLabel.textContent = t.advance_date_label; advanceAmountLabel.textContent = t.advance_amount_label; advanceNoteLabel.textContent = t.advance_note_label; advanceNoteEl.placeholder = t.advance_note_placeholder; addAdvanceBtn.textContent = '➕ ' + t.add_advance;
    thDate.textContent = t.th_date; thStart.textContent = t.th_start; thEnd.textContent = t.th_end; thDuration.textContent = t.th_duration; thRounded.textContent = t.th_rounded; thTask.textContent = t.th_task; thActions.textContent = t.th_actions; thAdvanceDate.textContent = t.th_advance_date; thAdvanceAmount.textContent = t.th_advance_amount; thAdvanceNote.textContent = t.th_advance_note; thAdvanceActions.textContent = t.th_advance_actions;
    updateTotalHoursVisibility(); updateEarningsDisplay();
  }
  // --- Apply Language Texts (Auth Page) ---
  function applyAuthLanguageTexts() {
      const t = translations[currentLang];
      authTitleText.textContent = t.auth_title || 'TheVann Tracker';
      authSigninSub.textContent = t.auth_signin_sub || 'Sign in...';
      authRegisterSub.textContent = t.auth_register_sub || 'Create account...';
      authResetSub.textContent = t.auth_reset_sub || 'Reset password...';
      forgotPasswordLink.textContent = t.forgot_password_link || 'Forgot Password?';
      resetBtn.textContent = t.send_reset_link || 'Send Reset Link';
      backToSigninLink.textContent = t.back_to_signin || 'Back to Sign In';
      showRegisterLink.textContent = t.auth_need_account || 'Need an account? Register';
      showSigninLink.textContent = t.auth_have_account || 'Already have an account? Sign In';
      Array.from(authLangButtons.children).forEach(btn => btn.style.fontWeight = btn.getAttribute('data-lang') === currentLang ? 'bold' : 'normal');
      Array.from(langButtons.children).forEach(btn => btn.style.fontWeight = btn.getAttribute('data-lang') === currentLang ? 'bold' : 'normal');
  }
  // Language Listeners
  langButtons.addEventListener('click', (ev)=>{ const b=ev.target; const lang=b.getAttribute('data-lang'); if(!lang) return; currentLang = lang; localStorage.setItem(LANG,currentLang); render(); });
  authLangButtons.addEventListener('click', (ev)=>{ const b=ev.target; const lang=b.getAttribute('data-lang'); if(!lang) return; currentLang = lang; localStorage.setItem(LANG,currentLang); applyAuthLanguageTexts(); });
  
  // --- Auth Form Switching Logic ---
  function showForm(formToShow) { signinForm.style.display = 'none'; registerForm.style.display = 'none'; resetPasswordForm.style.display = 'none'; formToShow.style.display = 'block'; authMessageEl.textContent = ''; applyAuthLanguageTexts(); }
  showRegisterLink.addEventListener('click', (e) => { e.preventDefault(); showForm(registerForm); });
  showSigninLink.addEventListener('click', (e) => { e.preventDefault(); showForm(signinForm); });
  forgotPasswordLink.addEventListener('click', (e) => { e.preventDefault(); showForm(resetPasswordForm); });
  backToSigninLink.addEventListener('click', (e) => { e.preventDefault(); showForm(signinForm); });
  
  // --- Email/Password Login ---
  signinForm.addEventListener('submit', async (e) => { e.preventDefault(); const email = loginEmailEl.value.trim(); const password = loginPasswordEl.value; authMessageEl.style.color = 'var(--accent)'; authMessageEl.textContent = 'Signing in...'; if (!email || !password) { authMessageEl.style.color = 'var(--danger)'; authMessageEl.textContent = 'Please enter email and password.'; return; } try { await signInWithEmailAndPassword(auth, email, password); authMessageEl.textContent = 'Sign in successful! Loading...'; } catch (error) { authMessageEl.style.color = 'var(--danger)'; if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') { authMessageEl.textContent = 'Invalid email or password.'; } else { console.error('Login Error:', error); authMessageEl.textContent = 'Error: ' + error.message; } } });
  // --- Email/Password Registration ---
  registerForm.addEventListener('submit', async (e) => { e.preventDefault(); const username = registerUsernameEl.value.trim(); const email = registerEmailEl.value.trim(); const password = registerPasswordEl.value; authMessageEl.style.color = 'var(--accent)'; authMessageEl.textContent = 'Checking...'; if (!username || !email || !password) { authMessageEl.style.color = 'var(--danger)'; authMessageEl.textContent = 'Please fill all fields.'; return; } if (password.length < 6) { authMessageEl.style.color = 'var(--danger)'; authMessageEl.textContent = 'Password must be >= 6 characters.'; return; } if (username.length < 3) { authMessageEl.style.color = 'var(--danger)'; authMessageEl.textContent = 'Username must be >= 3 characters.'; return; } try { if (await isUsernameTaken(username)) { authMessageEl.style.color = 'var(--danger)'; authMessageEl.textContent = 'Username taken.'; return; } authMessageEl.textContent = 'Creating account...'; const { user } = await createUserWithEmailAndPassword(auth, email, password); await updateProfile(user, { displayName: username }); await sendEmailVerification(user); const usernameRef = doc(db, 'usernames', username.toLowerCase()); await setDoc(usernameRef, { uid: user.uid }); const userDocRef = doc(db, 'users', user.uid); await setDoc(userDocRef, { username: username, email: email, entries: [], advances: [] }, { merge: true }); authMessageEl.style.color = 'var(--success)'; authMessageEl.textContent = translations[currentLang].reset_email_sent || `Verification email sent to ${email}. Check inbox!`; showForm(signinForm); registerUsernameEl.value = ''; registerEmailEl.value = ''; registerPasswordEl.value = ''; } catch (error) { authMessageEl.style.color = 'var(--danger)'; if (error.code === 'auth/email-already-in-use') { authMessageEl.textContent = 'Email already registered.'; } else if (error.code === 'auth/weak-password') { authMessageEl.textContent = 'Password too weak.'; } else { console.error('Registration Error:', error); authMessageEl.textContent = 'Error: ' + error.message; } } });
  // --- Password Reset Logic ---
  resetPasswordForm.addEventListener('submit', async (e) => { e.preventDefault(); const email = resetEmailEl.value.trim(); const t = translations[currentLang]; authMessageEl.textContent = ''; if (!email) { authMessageEl.style.color = 'var(--danger)'; authMessageEl.textContent = t.reset_fill_email || 'Please enter your email address.'; return; } authMessageEl.style.color = 'var(--accent)'; authMessageEl.textContent = 'Sending reset email...'; try { await sendPasswordResetEmail(auth, email); authMessageEl.style.color = 'var(--success)'; authMessageEl.textContent = t.reset_email_sent || 'Password reset email sent! Check your inbox.'; resetEmailEl.value = ''; } catch (error) { authMessageEl.style.color = 'var(--danger)'; console.error('Password Reset Error:', error); if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-email') { authMessageEl.textContent = 'Error: Email not found or invalid.'; } else { authMessageEl.textContent = 'Error: ' + error.message; } } });
  // --- Admin Panel Search (UID) ---
  adminSearchBtn.addEventListener('click', async () => { const searchUid = adminSearchInput.value.trim(); if (!searchUid) return; adminResultsEl.style.display = 'block'; adminResultsEl.innerHTML = 'Searching...'; const t = translations[currentLang]; const currency = t.currency || '฿'; try { const userRef = doc(db, 'users', searchUid); const userSnap = await getDoc(userRef); if (!userSnap.exists()) { adminResultsEl.innerHTML = `Error: User data not found for UID: ${searchUid}`; return; } const userData = userSnap.data(); const userEntries = userData.entries || []; const userAdvances = userData.advances || []; let totalAllTimeHours = 0; userEntries.forEach(entry => { totalAllTimeHours += entry.rounded || 0; }); let totalAllTimeAdvance = 0; userAdvances.forEach(adv => { totalAllTimeAdvance += adv.amount || 0; }); const totalGrossEarnings = totalAllTimeHours * HOURLY_RATE; const totalNetEarnings = totalGrossEarnings - totalAllTimeAdvance; adminResultsEl.innerHTML = `<strong>User:</strong> <span class="value">${userData.username || 'N/A'}</span><br> <strong>Email:</strong> <span class="value">${userData.email || 'N/A'}</span><br> <strong>Total Entries:</strong> <span class="value">${userEntries.length}</span><br> <strong>Total Advances:</strong> <span class="value">${userAdvances.length}</span><br> <hr style="border-color: rgba(255,255,255,0.1); margin: 8px 0;"> <strong>Total Hours:</strong> <span class="value">${totalAllTimeHours.toFixed(2)}</span><br> <strong>Gross Earnings:</strong> <span class="gross value">${totalGrossEarnings.toFixed(2)} ${currency}</span><br> <strong>Total Advance:</strong> <span class="advance value">${totalAllTimeAdvance.toFixed(2)} ${currency}</span><br> <strong>Net Earnings:</strong> <span class="net value">${totalNetEarnings.toFixed(2)} ${currency}</span>`; } catch (error) { console.error('Admin search error:', error); adminResultsEl.innerHTML = `Error: ${error.message}.`; } });
  // --- Add Advance Payment ---
  addAdvanceBtn.addEventListener('click', async () => { const date = advanceDateEl.value; const amountStr = advanceAmountEl.value; const note = advanceNoteEl.value.trim(); const t = translations[currentLang]; if (!date || !amountStr) { return alert(t.alert_advance_fill); } const amount = parseFloat(amountStr); if (isNaN(amount) || amount <= 0) { return alert(t.alert_advance_amount); } advances.push({ id: Date.now(), date: date, amount: amount, note: note }); advanceDateEl.valueAsDate = new Date(selectedYear, selectedMonth, Math.min(new Date().getDate(), 28)); advanceAmountEl.value = ''; advanceNoteEl.value = ''; await saveAll(); });
  // --- Admin Modal Listeners ---
  adminMenuBtn.addEventListener('click', () => { adminModalOverlay.style.display = 'flex'; });
  adminCloseBtn.addEventListener('click', () => { adminModalOverlay.style.display = 'none'; adminResultsEl.style.display = 'none'; adminSearchInput.value = ''; });
  adminModalOverlay.addEventListener('click', (e) => { if (e.target === adminModalOverlay) { adminModalOverlay.style.display = 'none'; adminResultsEl.style.display = 'none'; adminSearchInput.value = ''; } });
  // --- Total Hours Visibility Toggle Listener ---
  toggleTotalHoursBtn.addEventListener('click', () => { isTotalHoursHidden = !isTotalHoursHidden; localStorage.setItem(TOTAL_HOURS_HIDDEN, isTotalHoursHidden); updateTotalHoursVisibility(); });
  // --- Initialize App ---
  function init(){
    showLoadingState(); loadLocal(); const savedMonth = localStorage.getItem(MONTH); if(savedMonth){ try{ const o=JSON.parse(savedMonth); selectedYear=o.y; selectedMonth=o.m; }catch(e){} } if(typeof selectedYear==='undefined'){ const now=new Date(); selectedYear=now.getFullYear(); selectedMonth=now.getMonth(); } const initialDate = new Date(selectedYear, selectedMonth, Math.min(new Date().getDate(),28)); dateEl.valueAsDate = initialDate; advanceDateEl.valueAsDate = initialDate; currentLang = localStorage.getItem(LANG) || 'en'; isEarningsHidden = localStorage.getItem(EARNINGS_HIDDEN) === 'true'; isTotalHoursHidden = localStorage.getItem(TOTAL_HOURS_HIDDEN) === 'true'; applyTheme(); applyAuthLanguageTexts(); // Apply lang to auth page initially
  }
  init(); // Run initialization

  </script>
</body>
</html>
